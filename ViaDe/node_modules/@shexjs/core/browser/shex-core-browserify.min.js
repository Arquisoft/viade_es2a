!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).shexCore=e()}}((function(){return function e(t,n,r){function i(a,o){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,n,r)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){var r,i,s=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function u(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var p,c=[],l=!1,f=-1;function d(){l&&p&&(l=!1,p.length?c=p.concat(c):f=-1,c.length&&h())}function h(){if(!l){var e=u(d);l=!0;for(var t=c.length;t;){for(p=c,c=[];++f<t;)p&&p[f].run();f=-1,t=c.length}p=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new v(e,t)),1!==c.length||l||u(h)},v.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],2:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],3:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],4:[function(e,t,n){(function(t,r){var i=/%[sdj%]/g;n.format=function(e){if(!x(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(o(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,s=r.length,a=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),u=r[n];n<s;u=r[++n])v(u)||!E(u)?a+=" "+u:a+=" "+o(u);return a},n.deprecate=function(e,i){if(y(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return function(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}};var s,a={};function o(e,t){var r={seen:[],stylize:p};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(t)?r.showHidden=t:t&&n._extend(r,t),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),c(r,e,r.depth)}function u(e,t){var n=o.styles[t];return n?"["+o.colors[n][0]+"m"+e+"["+o.colors[n][1]+"m":e}function p(e,t){return e}function c(e,t,r){if(e.customInspect&&t&&w(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return x(i)||(i=c(e,i,r)),i}var s=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(x(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(m(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(v(t))return e.stylize("null","null")}(e,t);if(s)return s;var a=Object.keys(t),o=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),b(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(w(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(g(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(S(t))return e.stylize(Date.prototype.toString.call(t),"date");if(b(t))return l(t)}var p,E="",O=!1,_=["{","}"];(d(t)&&(O=!0,_=["[","]"]),w(t))&&(E=" [Function"+(t.name?": "+t.name:"")+"]");return g(t)&&(E=" "+RegExp.prototype.toString.call(t)),S(t)&&(E=" "+Date.prototype.toUTCString.call(t)),b(t)&&(E=" "+l(t)),0!==a.length||O&&0!=t.length?r<0?g(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),p=O?function(e,t,n,r,i){for(var s=[],a=0,o=t.length;a<o;++a)A(t,String(a))?s.push(f(e,t,n,r,String(a),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(f(e,t,n,r,i,!0))})),s}(e,t,r,o,a):a.map((function(n){return f(e,t,r,o,n,O)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(p,E,_)):_[0]+E+_[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i,s){var a,o,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(o=e.stylize("[Setter]","special")),A(r,i)||(a="["+i+"]"),o||(e.seen.indexOf(u.value)<0?(o=v(n)?c(e,u.value,null):c(e,u.value,n-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e})).join("\n")):o=e.stylize("[Circular]","special")),y(a)){if(s&&i.match(/^\d+$/))return o;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+o}function d(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function v(e){return null===e}function m(e){return"number"==typeof e}function x(e){return"string"==typeof e}function y(e){return void 0===e}function g(e){return E(e)&&"[object RegExp]"===O(e)}function E(e){return"object"==typeof e&&null!==e}function S(e){return E(e)&&"[object Date]"===O(e)}function b(e){return E(e)&&("[object Error]"===O(e)||e instanceof Error)}function w(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function _(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(y(s)&&(s=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(s)){var r=t.pid;a[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else a[e]=function(){};return a[e]},n.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=d,n.isBoolean=h,n.isNull=v,n.isNullOrUndefined=function(e){return null==e},n.isNumber=m,n.isString=x,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=y,n.isRegExp=g,n.isObject=E,n.isDate=S,n.isError=b,n.isFunction=w,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var e=new Date,t=[_(e.getHours()),_(e.getMinutes()),_(e.getSeconds())].join(":");return[e.getDate(),j[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){console.log("%s - %s",T(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!E(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:1,inherits:2}],5:[function(e,t,n){var r=function(){var e=/^[a-z][a-z0-9+.-]*:/i,t=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,n=/(?:^|\/)\.\.?(?:$|[\/#?])/;const r="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",i="http://www.w3.org/2001/XMLSchema#string";function s(e){if(!n.test(e))return e;for(var t="",r=e.length,i=-1,s=-1,a=0,o="/";i<r;){switch(o){case":":if(s<0&&"/"===e[++i]&&"/"===e[++i])for(;(s=i+1)<r&&"/"!==e[s];)i=s;break;case"?":case"#":i=r;break;case"/":if("."===e[i+1])switch(o=e[++i+1]){case"/":t+=e.substring(a,i-1),a=i+1;break;case void 0:case"?":case"#":return t+e.substring(a,i)+e.substr(i+1);case".":if(void 0===(o=e[++i+1])||"/"===o||"?"===o||"#"===o){if((a=(t+=e.substring(a,i-2)).lastIndexOf("/"))>=s&&(t=t.substr(0,a)),"/"!==o)return t+"/"+e.substr(i+1);a=i+1}}}o=e[++i]}return t+e.substring(a)}function a(e){switch(e.termType){case"NamedNode":return e.value;case"BlankNode":return"_:"+e.value;case"Literal":return'"'+e.value+'"'+(e.datatypeString===r?"@"+e.language:e.datatypeString===i?"":"^^"+e.datatypeString);default:throw Error("unknown RDFJS node type: "+JSON.stringify(e))}}function o(e,t){if(u(e))return t.namedNode(e);if(c(e))return t.blankNode(e.substr(2));if(p(e)){let n=d(e)||(f(e)===i?null:t.namedNode(f(e)));return t.literal(l(e),n)}throw Error("Unknown internal term type: "+JSON.stringify(e))}function u(e){if("string"!=typeof e)return!1;if(0===e.length)return!0;var t=e[0];return'"'!==t&&"_"!==t}function p(e){return"string"==typeof e&&'"'===e[0]}function c(e){return"string"==typeof e&&"_:"===e.substr(0,2)}function l(e){var t=/^"([^]*)"/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]}function f(e){var t=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]||(t[2]?r:i)}function d(e){var t=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]?t[1].toLowerCase():""}var h=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,v=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,m={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};function x(e){var t=m[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}return{RdfLangString:r,XsdString:i,resolveRelativeIRI:function(n,r){if(e.test(r))return r;switch(r[0]){case void 0:return n;case"#":return n+r;case"?":return n.replace(/(?:\?.*)?$/,r);case"/":let e=n.match(t);return("/"===r[1]?e[1]:e[0])+s(r);default:return s(n.replace(/[^\/?]*(?:\?.*)?$/,"")+r)}},isIRI:u,isLiteral:p,isBlank:c,isDefaultGraph:function(e){return!e},inDefaultGraph:function(e){return!e.graph},getLiteralValue:l,getLiteralType:f,getLiteralLanguage:d,internalTerm:a,internalTriple:function(e){return{subject:a(e.subject),predicate:a(e.predicate),object:a(e.object)}},externalTerm:o,externalTriple:function(e,t){return t.quad(o(e.subject,t),o(e.predicate,t),o(e.object,t))},intermalTermToTurtle:function(e,t,n){if(u(e)){h.test(e)&&(e=e.replace(v,x));var r=Object.keys(n).find(t=>e.startsWith(n[t]));if(r){var i=e.substr(n[r].length);if(-1===i.indexOf("\\"))return r+":"+i.replace(/([~!$&'()*+,;=/?#@%])/g,"\\$1")}return e.startsWith(t)?"<"+e.substr(t.length)+">":"<"+e+">"}if(c(e))return e;if(p(e)){var s=l(e),a=f(e),o=d(e);return h.test(s)&&(s=s.replace(v,x)),o?'"'+s+'"@'+o:a?'"'+s+'"^^'+this._encodeIriOrBlankNode(a):'"'+s+'"'}throw Error("Unknown internal term type: "+JSON.stringify(e))}}}();void 0!==e&&void 0!==n&&(t.exports=r)},{}],6:[function(t,n,r){var i=function(){var n=t("./RdfTerm");const r=t("hierarchy-closure"),i={_namespace:"http://www.w3.org/ns/shex#"};["Schema","@context","imports","startActs","start","shapes","ShapeOr","ShapeAnd","shapeExprs","nodeKind","NodeConstraint","iri","bnode","nonliteral","literal","datatype","length","minlength","maxlength","pattern","flags","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits","values","ShapeNot","shapeExpr","Shape","virtual","closed","extra","expression","inherit","semActs","ShapeRef","reference","ShapeExternal","EachOf","OneOf","expressions","min","max","annotation","TripleConstraint","inverse","negated","predicate","valueExpr","Inclusion","include","Language","languageTag","IriStem","LiteralStem","LanguageStem","stem","IriStemRange","LiteralStemRange","LanguageStemRange","exclusion","Wildcard","SemAct","name","code","Annotation","object"].forEach(e=>{i[e]=i._namespace+e});const s={_namespace:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"};["type","first","rest","nil"].forEach(e=>{s[e]=s._namespace+e});const a={_namespace:"http://www.w3.org/2001/XMLSchema#"};["anyURI"].forEach(e=>{a[e]=a._namespace+e});const o={_namespace:"http://www.w3.org/2002/07/owl#"};["Thing"].forEach(e=>{o[e]=o._namespace+e});const u={};var p=-1;function c(e){e||(e={});for(var t,n=1,r=arguments.length;n<r&&(t=arguments[n]||{});n++)for(var i in t)e[i]=t[i];return e}function l(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}function f(e){return"string"==typeof e}var d={SX:i,RDF:s,version:function(){return"0.5.0"},Visitor:function(){var e=this;var t={runtimeError:function(e){throw e},visitSchema:function(t){var n={type:"Schema"};return e._expect(t,"type","Schema"),this._maybeSet(t,n,"Schema",["@context","prefixes","base","imports","startActs","start","shapes"],["_base","_prefixes","_index","_sourceMap"]),n},visitPrefixes:function(e){return void 0===e?void 0:function(e,t){var n={};return Object.keys(e).forEach((function(r){n[r]=t(e[r])})),n}(e,(function(e){return e}))},visitIRI:function(e){return e},visitImports:function(e){var t=this;return e.map((function(e){return t.visitIRI(e)}))},visitStartActs:function(e){var t=this;return void 0===e?void 0:e.map((function(e){return t.visitSemAct(e)}))},visitSemActs:function(e){var t=this;if(void 0!==e){var n=[];return Object.keys(e).forEach((function(r){n.push(t.visitSemAct(e[r],r))})),n}},visitSemAct:function(t,n){var r={type:"SemAct"};return e._expect(t,"type","SemAct"),this._maybeSet(t,r,"SemAct",["name","code"]),r},visitShapes:function(e){var t=this;if(void 0!==e)return e.map(e=>t.visitShapeExpr(e))},visitProductions999:function(e){var t=this;if(void 0!==e){var n={};return Object.keys(e).forEach((function(r){n[r]=t.visitExpression(e[r],r)})),n}},visitShapeExpr:function(e,t){if(f(e))return this.visitShapeRef(e);var n="Shape"===e.type?this.visitShape(e,t):"NodeConstraint"===e.type?this.visitNodeConstraint(e,t):"ShapeAnd"===e.type?this.visitShapeAnd(e,t):"ShapeOr"===e.type?this.visitShapeOr(e,t):"ShapeNot"===e.type?this.visitShapeNot(e,t):"ShapeExternal"===e.type?this.visitShapeExternal(e):null;if(null===n)throw Error("unexpected shapeExpr type: "+e.type);return n},_visitShapeGroup:function(e,t){this._testUnknownAttributes(e,["id","shapeExprs"],e.type,this.visitShapeNot);var n=this,r={type:e.type};return"id"in e&&(r.id=e.id),r.shapeExprs=e.shapeExprs.map((function(e){return n.visitShapeExpr(e,t)})),r},visitShapeNot:function(e,t){this._testUnknownAttributes(e,["id","shapeExpr"],"ShapeNot",this.visitShapeNot);var n={type:e.type};return"id"in e&&(n.id=e.id),n.shapeExpr=this.visitShapeExpr(e.shapeExpr,t),n},visitShape:function(t,n){var r={type:"Shape"};return e._expect(t,"type","Shape"),this._maybeSet(t,r,"Shape",["id","closed","expression","extra","semActs","annotations"]),r},visitNodeConstraint:function(t,n){var r={type:"NodeConstraint"};return e._expect(t,"type","NodeConstraint"),this._maybeSet(t,r,"NodeConstraint",["id","nodeKind","datatype","pattern","flags","length","reference","minlength","maxlength","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits","values","annotations","semActs"]),r},visitShapeRef:function(e){if("string"!=typeof e){let t=Exception("visitShapeRef expected a string, not "+JSON.stringify(e));throw console.warn(t),t}return e},visitShapeExternal:function(e){return this._testUnknownAttributes(e,["id"],"ShapeExternal",this.visitShapeNot),c("id"in e?{id:e.id}:{},{type:"ShapeExternal"})},_visitGroup:function(e,t){var n=this,r=Object.assign("id"in e?{id:null}:{},{type:e.type});return r.expressions=e.expressions.map((function(e){return n.visitExpression(e)})),this._maybeSet(e,r,"expr",["id","min","max","annotations","semActs"],["expressions"])},visitTripleConstraint:function(e){return this._maybeSet(e,Object.assign("id"in e?{id:null}:{},{type:"TripleConstraint"}),"TripleConstraint",["id","inverse","predicate","valueExpr","min","max","annotations","semActs"])},visitExpression:function(e){if("string"==typeof e)return this.visitInclusion(e);var t="TripleConstraint"===e.type?this.visitTripleConstraint(e):"OneOf"===e.type?this.visitOneOf(e):"EachOf"===e.type?this.visitEachOf(e):null;if(null===t)throw Error("unexpected expression type: "+e.type);return t},visitValues:function(e){var t=this;return e.map((function(e){return l(e)||"Language"===e.type?e:t.visitStemRange(e)}))},visitStemRange:function(t){var n=this;"type"in t||n.runtimeError(Error("expected "+JSON.stringify(t)+" to have a 'type' attribute."));var r,i=["IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];return-1===i.indexOf(t.type)&&n.runtimeError(Error("expected type attribute '"+t.type+"' to be in '"+i+"'.")),l(t)?(e._expect(t.stem,"type","Wildcard"),r={type:t.type,stem:{type:"Wildcard"}}):r={type:t.type,stem:t.stem},t.exclusions&&(r.exclusions=t.exclusions.map((function(e){return n.visitExclusion(e)}))),r},visitExclusion:function(e){if(l(e))return e;"type"in e||_Visitor.runtimeError(Error("expected "+JSON.stringify(e)+" to have a 'type' attribute."));var t=["IriStem","LiteralStem","LanguageStem"];return-1===t.indexOf(e.type)&&_Visitor.runtimeError(Error("expected type attribute '"+e.type+"' to be in '"+t+"'.")),{type:e.type,stem:e.stem}},visitInclusion:function(e){if("string"!=typeof e){let t=Exception("visitInclusion expected a string, not "+JSON.stringify(e));throw console.warn(t),t}return e},_maybeSet:function(e,t,n,r,i){var s=this;return this._testUnknownAttributes(e,i?r.concat(i):r,n,this._maybeSet),r.forEach((function(n){var r="visit"+n.charAt(0).toUpperCase()+n.slice(1);if(n in e){var i=s[r];if("function"!=typeof i)throw Error(r+" not found in Visitor");var a=i.call(s,e[n]);void 0!==a&&(t[n]=a)}})),t},_visitValue:function(e){return e},_visitList:function(e){return e.slice()},_testUnknownAttributes:function(e,t,n,r){var i=Object.keys(e).reduce((function(e,n){return"type"!==n&&-1===t.indexOf(n)?e.concat(n):e}),[]);if(i.length>0){var s=Error("unknown propert"+(i.length>1?"ies":"y")+": "+i.map((function(e){return'"'+e+'"'})).join(",")+" in "+n+": "+JSON.stringify(e));throw Error.captureStackTrace(s,r),s}}};return t.visitBase=t.visitStart=t.visitVirtual=t.visitClosed=t["visit@context"]=t._visitValue,t.visitInherit=t.visitExtra=t.visitAnnotations=t._visitList,t.visitInverse=t.visitPredicate=t._visitValue,t.visitName=t.visitId=t.visitCode=t.visitMin=t.visitMax=t._visitValue,t.visitType=t.visitNodeKind=t.visitDatatype=t.visitPattern=t.visitFlags=t.visitLength=t.visitMinlength=t.visitMaxlength=t.visitMininclusive=t.visitMinexclusive=t.visitMaxinclusive=t.visitMaxexclusive=t.visitTotaldigits=t.visitFractiondigits=t._visitValue,t.visitOneOf=t.visitEachOf=t._visitGroup,t.visitShapeAnd=t.visitShapeOr=t._visitShapeGroup,t.visitInclude=t._visitValue,t.visitValueExpr=t.visitShapeExpr,t},ShExJtoAS:function(e){return e._prefixes=e.prefixes||{},e._index=this.index(e),e},AStoShExJ:function(e,t){return e["@context"]=e["@context"]||"http://www.w3.org/ns/shex.jsonld",e},ShExRVisitor:function(e){var t=d.Visitor(),r={},i=t.visitShapeExpr,s=(t.visitValueExpr,t.visitExpression);return t.keepShapeExpr=i,t.visitShapeExpr=t.visitValueExpr=function(t,n){if("string"==typeof t)return t;if("id"in t){if(-1!==e.indexOf(t.id)||1===Object.keys(t).length)return t.id;delete t.id}return i.call(this,t,n)},t.visitExpression=function(e){if("string"==typeof e)return e;if("id"in e&&e.id in r)return r[e.id].refCount++,e.id;var t=s.call(this,e);return r[e.id]={refCount:1,expr:t},t},t.cleanIds=function(){for(var e in r){var t=r[e];1===t.refCount&&n.isBlank(t.expr.id)&&delete t.expr.id}},t},ShExRtoShExJ:function(e){var t=[];"shapes"in e&&(t=t.concat(e.shapes.map(e=>e.id)));var n=this.ShExRVisitor(t);return"start"in e&&(e.start=n.visitShapeExpr(e.start)),"shapes"in e&&(e.shapes=e.shapes.map(e=>n.keepShapeExpr(e))),n.cleanIds(),e},valGrep:function(e,t,n){var r=[];for(var i in e){var s=e[i];"object"==typeof s&&("type"in s&&s.type===t&&r.push(n(s)),r.push.apply(r,this.valGrep(s,t,n)))}return r},n3jsToTurtle:function(e){return this.valGrep(e,"TestedTriple",(function(e){return["subject","predicate","object"].map(t=>(function(e){return"object"==typeof e?'"'+e.value+'"'+("type"in e?"^^<"+e.type+">":"language"in e?"@"+e.language:""):n.isIRI(e)?"<"+e+">":n.isBlank(e)?e:"???"})(e[t])).join(" ")+" ."}))},valToN3js:function(e){return this.valGrep(e,"TestedTriple",(function(e){var t=JSON.parse(JSON.stringify(e));return"object"==typeof e.object&&(t.object='"'+e.object.value+'"'+("type"in e.object?"^^"+e.object.type:"language"in e.object?"@"+e.object.language:"")),t}))},n3jsToTurtle:function(e){return e.map((function(e){return["subject","predicate","object"].map(t=>(function(e){if(n.isIRI(e))return"<"+e+">";if(n.isBlank(e))return e;var t=n.getLiteralType(e);return t&&"http://www.w3.org/2001/XMLSchema#string"!==t?'"'+n.getLiteralValue(e)+'"^^<'+t+">":e})(e[t])).join(" ")+" ."}))},index:function(e){let t={shapeExprs:new Map,tripleExprs:new Map},n=d.Visitor(),r=n.visitExpression;n.visitExpression=function(e){return"object"==typeof e&&"id"in e&&(t.tripleExprs[e.id]=e),r.call(n,e)};let i=n.visitShapeExpr;return n.visitShapeExpr=n.visitValueExpr=function(e,r){return"object"==typeof e&&"id"in e&&(t.shapeExprs[e.id]=e),i.call(n,e,r)},n.visitSchema(e),t},canonicalize:function(e,t){var n=JSON.parse(JSON.stringify(e));n["@context"]=n["@context"]||"http://www.w3.org/ns/shex.jsonld",delete n._prefixes,delete n._base;let r=n._index||this.index(e);delete n._index;n._sourceMap;delete n._sourceMap;var i=d.Visitor(),s=[],a=i.visitInclusion,o=i.visitExpression;return i.visitInclusion=function(e){return-1===s.indexOf(e)&&e in r.tripleExprs?(s.push(e),o.call(i,r.tripleExprs[e])):a.call(i,e)},i.visitExpression=function(e){return"object"==typeof e&&"id"in e?-1===s.indexOf(e.id)?(s.push(e.id),o.call(i,r.tripleExprs[e.id])):e.id:o.call(i,e)},t&&(i.visitIRI=function(e){return e.replace(t,"")},"imports"in n&&(n.imports=i.visitImports(n.imports))),"shapes"in n&&(n.shapes=Object.keys(r.shapeExprs).sort().map(e=>("extra"in r.shapeExprs[e]&&r.shapeExprs[e].extra.sort(),i.visitShapeExpr(r.shapeExprs[e])))),n},BiDiClosure:function(){return{needs:{},neededBy:{},inCycle:[],test:function(){function e(e,t){var n=JSON.stringify(e),r=JSON.stringify(t);if(n!==r)throw Error(n+" !== "+r)}this.add(2,3),e(this.needs,{2:[3]}),e(this.neededBy,{3:[2]}),this.add(1,2),e(this.needs,{1:[2,3],2:[3]}),e(this.neededBy,{3:[2,1],2:[1]}),this.add(1,3),e(this.needs,{1:[2,3],2:[3]}),e(this.neededBy,{3:[2,1],2:[1]}),this.add(3,4),e(this.needs,{1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{3:[2,1],2:[1],4:[3,2,1]}),this.add(6,7),e(this.needs,{6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6],3:[2,1],2:[1],4:[3,2,1]}),this.add(5,6),e(this.needs,{5:[6,7],6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],3:[2,1],2:[1],4:[3,2,1]}),this.add(5,7),e(this.needs,{5:[6,7],6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],3:[2,1],2:[1],4:[3,2,1]}),this.add(7,8),e(this.needs,{5:[6,7,8],6:[7,8],7:[8],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],8:[7,6,5],3:[2,1],2:[1],4:[3,2,1]}),this.add(4,5),e(this.needs,{1:[2,3,4,5,6,7,8],2:[3,4,5,6,7,8],3:[4,5,6,7,8],4:[5,6,7,8],5:[6,7,8],6:[7,8],7:[8]}),e(this.neededBy,{2:[1],3:[2,1],4:[3,2,1],5:[4,3,2,1],6:[5,4,3,2,1],7:[6,5,4,3,2,1],8:[7,6,5,4,3,2,1]})},add:function(e,t,n){var r=this;e in r.needs||(r.needs[e]=[]),t in r.neededBy||(r.neededBy[t]=[]),r.needs[e]=r.needs[e].concat([t],r.needs[t]).filter((function(e,t,n){return void 0!==e&&n.indexOf(e)===t})),r.neededBy[t]=r.neededBy[t].concat([e],r.neededBy[e]).filter((function(e,t,n){return void 0!==e&&n.indexOf(e)===t})),e in this.neededBy&&this.neededBy[e].forEach((function(e){r.needs[e]=r.needs[e].concat([t],r.needs[t]).filter((function(e,t,n){return void 0!==e&&n.indexOf(e)===t}))})),t in this.needs&&this.needs[t].forEach((function(t){r.neededBy[t]=r.neededBy[t].concat([e],r.neededBy[e]).filter((function(e,t,n){return void 0!==e&&n.indexOf(e)===t}))})),-1!==r.needs[e].indexOf(e)&&(r.inCycle=r.inCycle.concat(r.needs[e]))},trim:function(){function e(e){for(var t=e.length-1;t>-1;--t)e.indexOf(e[t])<t&&e.splice(t,t+1)}for(k in this.needs)e(this.needs[k]);for(k in this.neededBy)e(this.neededBy[k])},foundIn:{},addIn:function(e,t){this.foundIn[e]=t}}},nestShapes:function(e,t={}){var n=this;const r=e._index||this.index(e);"no"in t||(t.no=!1);let i=Object.keys(r.shapeExprs||[]),s={};i.forEach(e=>{let t=r.shapeExprs[e];if(o(e,null),"Shape"===(t=n.skipDecl(t)).type)"extends"in t&&t.extends.forEach(e=>o(e,t)),"expression"in t&&(n.simpleTripleConstraints(t)||[]).forEach(t=>{o(n.getValueType(t.valueExpr,!0),{type:"tc",shapeLabel:e,tc:t})});else if("NodeConstraint"!==t.type)throw Error("nestShapes currently only supports Shapes and NodeConstraints")});let a=Object.keys(s).filter(e=>1===s[e].length&&"tc"===s[e][0].type&&"Shape"===n.skipDecl(r.shapeExprs[e]).type).reduce((e,t)=>(e[t]={referrer:s[t][0].shapeLabel,predicate:s[t][0].tc.predicate},e),{});if(!t.no){let e={};if(t.rename){"transform"in t||(t.transform=function(){let e=i.reduce((e,t,n)=>(e[t]="_:transformed"+n,e),{});return function(t,n){return e[t]}}()),Object.keys(a).forEach(n=>{let o=r.shapeExprs[n],u=t.transform(n,o);if(e[n]=u,i[i.indexOf(n)]=u,a[u]=a[n],a[u].was=n,delete a[n],r.shapeExprs[u]=r.shapeExprs[n],delete r.shapeExprs[n],1!==s[n].length)throw Error("assertion: "+n+" doesn't have one reference: ["+s[n]+"]");let p=s[n][0];if("tc"!==p.type)throw"Shape"===p.type?Error("assertion: rename not implemented for Shape: "+p):Error("assertion: "+p.type+" not TripleConstraint or Shape");if("ShapeRef"!==p.tc.valueExpr.type)throw Error("assertion: rename not implemented for TripleConstraint expr: "+p.tc.valueExpr);p.tc.valueExpr.reference=u}),Object.keys(a).forEach(t=>{let n=a[t];n.referrer in e&&(n.newReferrer=e[n.referrer])});let n={};i.forEach(e=>n[e]=r.shapeExprs[e]),r.shapeExprs=n}else Object.keys(a).forEach(e=>{s[e][0].tc.valueExpr=r.shapeExprs[e].shapeExpr,delete r.shapeExprs[e]})}return a;function o(e,t){e in s||(s[e]=[]),t&&s[e].push(t)}},getPredicateUsage:function(e,t={}){var n=this;let i=r.create();Object.keys(e.shapes).forEach(t=>{let r=n.skipDecl(e.shapes[t]);"Shape"===r.type&&(r.extends||[]).forEach(e=>i.add(e,t))}),Object.keys(e.shapes).forEach(e=>{e in i.parents||(i.parents[e]=[])});let s={};return Object.keys(e.shapes).forEach(r=>{let a=n.skipDecl(e.shapes[r]);if("Shape"===a.type){(n.simpleTripleConstraints(a)||[]).forEach(e=>{let a=n.getValueType(e.valueExpr);if(e.predicate in s){s[e.predicate].uses.push(r);let n=s[e.predicate].commonType;if("object"==typeof n||null===n)t[e.predicate].references.push({shapeLabel:r,newType:a});else if("object"==typeof a)s[e.predicate].commonType=null,t[e.predicate]={shapeLabel:r,predicate:e.predicate,curType:n,newType:a,references:[]};else if(n===a);else if(-1!==i.parents[n].indexOf(a))s[e.predicate].polymorphic=!0;else{let o=i.parents[a].indexOf(n);if(-1===o){let o=i.parents[n].filter(e=>-1!==i.parents[a].indexOf(e));0===o.length?(t[e.predicate]={shapeLabel:r,predicate:e.predicate,curType:n,newType:a,references:[]},s[e.predicate].commonType=null):(s[e.predicate].commonType=o[0],s[e.predicate].polymorphic=!0)}else s[e.predicate].commonType=i.parents[a][o],s[e.predicate].polymorphic=!0}}else s[e.predicate]={uses:[r],commonType:a,polymorphic:!1},"object"==typeof a&&(t[e.predicate]={shapeLabel:r,predicate:e.predicate,newType:a,references:[]})})}}),s},simpleTripleConstraints:function(e){if(!("expression"in e))return[];if("TripleConstraint"===e.expression.type)return[e.expression];if("EachOf"===e.expression.type&&!e.expression.expressions.find(e=>"TripleConstraint"!==e.type))return e.expression.expressions;throw Error("can't (yet) express "+JSON.stringify(e))},skipDecl:function(e){return"ShapeDecl"===e.type?e.shapeExpr:e},getValueType:function(e){return"string"==typeof e?e:e.reference?e.reference:"iri"===e.nodeKind?o.Thing:e.datatype?e.datatype:e},getDependencies:function(e,t){return t=t||this.BiDiClosure(),(e.shapes||[]).forEach((function(e){function n(r,i){if("string"==typeof r)t.add(e.id,r);else if("ShapeOr"===r.type||"ShapeAnd"===r.type)r.shapeExprs.forEach((function(e){n(e,i)}));else if("ShapeNot"===r.type)n(r.shapeExpr,1^i);else if("Shape"===r.type)!function(e,r){e.inherit&&e.inherit.length>0&&e.inherit.forEach((function(n){t.add(e.id,n)}));e.expression&&function r(i,s){if("string"==typeof i)t.add(e.id,i);else if("id"in i&&t.addIn(i.id,e.id),"TripleConstraint"===i.type)!function(r,i){if(r.valueExpr&&n(r.valueExpr,i),i&&-1!==t.inCycle.indexOf(e.id))throw Error("Structural error: "+e.id+" appears in negated cycle")}(i,s);else{if("OneOf"!==i.type&&"EachOf"!==i.type)throw Error("expected {TripleConstraint,OneOf,EachOf,Inclusion} in "+i);!function(e,t){e.forEach((function(e){r(e,t)}))}(i.expressions)}}(e.expression,r)}(r,i);else if("NodeConstraint"===r.type);else if("ShapeExternal"!==r.type)throw Error("expected Shape{And,Or,Ref,External} or NodeConstraint in "+JSON.stringify(r))}n(e,0)})),t},partition:function(e,t,n,r){const i=e._index||this.index(e),s={shapeExprs:new Map,tripleExprs:new Map};t=t instanceof Array?t:[t],n=n||this.getDependencies(e),r=r||function(e,t){throw new Error("Error: can't find shape "+(t?t+" dependency "+e:e))};var a={};for(var o in e)a[o]="shapes"===o?[]:e[o];return t.forEach((function(e){if(e in s.shapeExprs);else if(e in i.shapeExprs){const t=i.shapeExprs[e];a.shapes.push(t),s.shapeExprs[t.id]=t,e in n.needs&&n.needs[e].forEach((function(t){if(t in n.foundIn&&(t=n.foundIn[t]),t in s.shapeExprs);else if(t in i.shapeExprs){const e=i.shapeExprs[t];a.shapes.push(e),s.shapeExprs[e.id]=e}else r(t,e)}))}else r(e,"supplied")})),a},flatten:function(e,t,n){return this.Visitor().visitSchema(e)},emptySchema:function(){return{type:"Schema"}},merge:function(e,t,n,r){var i,s=r?e:this.emptySchema();"_base"in e&&(s._base=e._base),"_base"in t&&("_base"in e&&!n||(s._base=t._base)),i="_prefixes",Object.keys(e[i]||{}).forEach((function(t){i in s||(s[i]={}),s[i][t]=e[i][t]})),Object.keys(t[i]||{}).forEach((function(r){i in e&&r in e[i]&&!n||(i in s||(s[i]={}),s[i][r]=t[i][r])})),function(r){(e[r]||new Map).forEach((function(t,n,i){r in s||(s[r]=new Map),s[r].set(n,e[r].get(n))})),(t[r]||new Map).forEach((function(i,a,o){r in e&&e[r].has(a)&&!n||(r in s||(s[r]=new Map),s[r].set(a,t[r].get(a)))}))}("_sourceMap"),"imports"in t&&("imports"in e&&!n||(s.imports=t.imports)),"startActs"in e&&(s.startActs=e.startActs),"startActs"in t&&("startActs"in e&&!n||(s.startActs=t.startActs)),"start"in e&&(s.start=e.start),"start"in t&&("start"in e&&!n||(s.start=t.start));let a=e._index||this.index(e);return r||(e.shapes||[]).forEach((function(e){"shapes"in s||(s.shapes=[]),s.shapes.push(e)})),(t.shapes||[]).forEach((function(t){"shapes"in e&&t.id in a.shapeExprs&&!n||("shapes"in s||(s.shapes=[]),s.shapes.push(t))})),(e._index||t._index)&&(s._index=this.index(s)),s},absolutizeResults:function(e,t){function r(e,r){-1!==["shape","reference","node","subject","predicate","object"].indexOf(e)&&n.isIRI(r[e])&&(r[e]=n.resolveRelativeIRI(t,r[e]))}return function e(t){Object.keys(t).forEach((function(n){"object"==typeof t[n]&&e(t[n]),r&&r(n,t)}))}(e),e},validateSchema:function(e){var t=this.Visitor(),n=currentExtra=null,i=!1,s=!1,a=t.visitShape,o=r.create(),u=r.create();let p=e.index||this.index(e);t.visitShape=function(e,n){var r=currentExtra;currentExtra=e.extra;var i=a.call(t,e,n);return currentExtra=r,i};var c=t.visitShapeNot;t.visitShapeNot=function(e,n){var r=i;i^=!0;var s=c.call(t,e,n);return i=r,s};var l=t.visitTripleConstraint;t.visitTripleConstraint=function(e){var n=i;currentExtra&&-1!==currentExtra.indexOf(e.predicate)&&(i^=!0),s=!0;var r=l.call(t,e);return s=!1,i=n,r};var f=t.visitShapeRef;t.visitShapeRef=function(e){if(!(e in p.shapeExprs))throw m(Error("Structural error: reference to "+JSON.stringify(e)+" not found in schema shape expressions:\n"+v(p.shapeExprs)+"."),e);if(!s&&e===n)throw m(Error("Structural error: circular reference to "+n+"."),e);return(i?o:u).add(n,e),f.call(t,e)};var d=t.visitInclusion;t.visitInclusion=function(e){if(!p.tripleExprs[e])throw m(Error("Structural error: included shape "+e+" not found in schema triple expressions:\n"+v(p.tripleExprs)+"."),e);return d.call(t,e)},(e.shapes||[]).forEach((function(e){n=e.id,t.visitShapeExpr(e,e.id)}));let h=Object.keys(o.children).filter(e=>o.children[e].filter(t=>t in o.children&&-1!==o.children[t].indexOf(e)||t in u.children&&-1!==u.children[t].indexOf(e)).length>0);if(h.length)throw m(Error("Structural error: circular negative dependencies on "+h.join(",")+"."),h[0]);function v(e){return e?Object.keys(e).map(e=>"_:"===e.substr(0,2)?e:"<"+e+">").join("\n        "):"- none defined -"}function m(t,n){return"_sourceMap"in e&&(t.location=(e._sourceMap.get(n)||[void 0])[0]),t}},isWellDefined:function(e){return this.validateSchema(e),e},walkVal:function(e,t){var n=this;if("NodeTest"===e.type)return null;if("ShapeTest"===e.type)return"solution"in e?n.walkVal(e.solution,t):null;if("ShapeOrResults"===e.type)return n.walkVal(e.solution,t);if("EachOfSolutions"===e.type||"OneOfSolutions"===e.type)return e.solutions.reduce((e,r)=>(r.expressions.forEach(r=>{var i=n.walkVal(r,t);i&&Object.keys(i).forEach(t=>{e[t]=t in e?e[t].concat(i[t]):i[t]})}),e),{});if("OneOfSolutions"===e.type)return e.solutions.reduce((e,r)=>(Object.assign(e,n.walkVal(r,t)),e),{});if("TripleConstraintSolutions"===e.type){if("solutions"in e){var r={},i=[];return r[e.predicate]=i,e.solutions.forEach(e=>{var r=[];if(function e(r){if(!r)return!1;if(r.node===s.nil)return!0;if("solution"in r&&"solutions"in r.solution&&1===r.solution.solutions.length&&"expressions"in r.solution.solutions[0]&&2===r.solution.solutions[0].expressions.length&&"predicate"in r.solution.solutions[0].expressions[0]&&r.solution.solutions[0].expressions[0].predicate===s.first&&r.solution.solutions[0].expressions[1].predicate===s.rest){var a=r.solution.solutions[0].expressions,o=a[0],u=a[1].solutions[0],p=o.solutions[0],c=t(p);if("referenced"in p){var l=n.walkVal(p.referenced,t);l&&(c.nested=l)}return i.push(c),u.object===s.nil||e(u.referenced)}}(e.referenced))i=i.concat(r);else{var a=t(e);if("referenced"in e){var o=n.walkVal(e.referenced,t);o&&(a.nested=o)}i.push(a)}}),i.length?r:null}return null}if("Recursion"===e.type)return null;throw Error("unknown shapeExpression type in "+JSON.stringify(e))},valToValues:function(e){return this.walkVal(e,(function(e){return{ldterm:e.object}}))},valToExtension:function(e,t){return function e(n){var r=[],i={};function s(e){if(null===i)return e;if(e.constructor===Array)return i=null,e;for(a in e){if(a in i)return i=null,e;i[a]=e[a]}return e}for(var a in n)if("extensions"===a)n[a]&&r.push(s(n[a][t]));else if("nested"===a){var o=e(n[a]);o.constructor===Array?o.forEach(s):s(o),r=r.concat(o)}else r.push(s(e(n[a])));return 1===r.length?r[0]:i||r}(this.walkVal(e,(function(e){return{extensions:e.extensions}})))},valuesToSchema:function(e){var t=e;if(e[s.type][0].ldterm===i.Schema){var n={"@context":"http://www.w3.org/ns/shex.jsonld",type:"Schema"};i.startActs in t&&(n.startActs=t[i.startActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),i.imports in t&&(n.imports=t[i.imports].map(e=>e.ldterm)),e[i.start]&&(n.start=c({id:e[i.start][0].ldterm},o(e[i.start][0].nested)));var r=e[i.shapes];return r&&(n.shapes=r.map(e=>c({id:e.ldterm},o(e.nested)))),n}throw Error("unknown schema type in "+JSON.stringify(e));function a(e,t,n){var r=e[s.type][0].ldterm.substr(i._namespace.length),a=t[r];if(!a)return u;if(a.nary)return(o={type:r})[a.prop]=e[i[a.prop]].map(e=>p(e)),o;var o={type:r};return a.prop&&(o[a.prop]=p(e[i[a.prop]][0])),o;function p(e){return a.expr&&"nested"in e?c({id:e.ldterm},n(e.nested)):e.ldterm}}function o(e){if((n=a(e,{ShapeAnd:{nary:!0,expr:!0,prop:"shapeExprs"},ShapeOr:{nary:!0,expr:!0,prop:"shapeExprs"},ShapeNot:{nary:!1,expr:!0,prop:"shapeExpr"},ShapeRef:{nary:!1,expr:!1,prop:"reference"},ShapeExternal:{nary:!1,expr:!1,prop:null}},o))!==u)return n;var t=e[s.type][0].ldterm;if(t===i.Shape){var n={type:"Shape"};return["closed"].forEach(t=>{i[t]in e&&(n[t]=!!e[i[t]][0].ldterm.value)}),i.extra in e&&(n.extra=e[i.extra].map(e=>e.ldterm)),i.expression in e&&(n.expression="nested"in e[i.expression][0]?c({id:e[i.expression][0].ldterm},l(e[i.expression][0].nested)):e[i.expression][0].ldterm),i.annotation in e&&(n.annotations=e[i.annotation].map(e=>({type:"Annotation",predicate:e.nested[i.predicate][0].ldterm,object:e.nested[i.object][0].ldterm}))),i.semActs in e&&(n.semActs=e[i.semActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),n}if(t===i.NodeConstraint){n={type:"NodeConstraint"};return i.values in e&&(n.values=e[i.values].map(e=>(function e(t,n){if("nested"in t){var r=t.nested[s.type][0].ldterm;if(-1!==[i.IriStem,i.LiteralStem,i.LanguageStem].indexOf(r)){var a=t.nested[i.stem][0].ldterm.value;return{type:r.substr(i._namespace.length),stem:a}}if(-1!==[i.Language].indexOf(r))return{type:"Language",languageTag:t.nested[i.languageTag][0].ldterm.value};if(-1!==[i.IriStemRange,i.LiteralStemRange,i.LanguageStemRange].indexOf(r)){var o=t.nested[i.stem][0],u=o;"object"==typeof o&&("object"==typeof o.ldterm?u=o.ldterm:o.ldterm.startsWith("_:")&&(u={type:"Wildcard"}));var p={type:r.substr(i._namespace.length),stem:"Wildcard"!==u.type?u.value:u};return i.exclusion in t.nested&&(p.exclusions=t.nested[i.exclusion].map(t=>e(t,r!==i.IriStemRange))),p}throw Error("unknown objectValue type in "+JSON.stringify(t))}return n?t.ldterm.value:t.ldterm})(e))),i.nodeKind in e&&(n.nodeKind=e[i.nodeKind][0].ldterm.substr(i._namespace.length)),["length","minlength","maxlength","mininclusive","maxinclusive","minexclusive","maxexclusive","totaldigits","fractiondigits"].forEach(t=>{i[t]in e&&(n[t]=parseFloat(e[i[t]][0].ldterm.value))}),i.pattern in e&&(n.pattern=e[i.pattern][0].ldterm.value),i.flags in e&&(n.flags=e[i.flags][0].ldterm.value),i.datatype in e&&(n.datatype=e[i.datatype][0].ldterm),n}throw Error("unknown shapeExpr type in "+JSON.stringify(e))}function l(e){if((t=a(e,{EachOf:{nary:!0,expr:!0,prop:"expressions"},OneOf:{nary:!0,expr:!0,prop:"expressions"},Inclusion:{nary:!1,expr:!1,prop:"include"}},l))!==u)return f(e,t),t;if(e[s.type][0].ldterm===i.TripleConstraint){var t={type:"TripleConstraint",predicate:e[i.predicate][0].ldterm};return["inverse"].forEach(n=>{i[n]in e&&(t[n]=!!e[i[n]][0].ldterm.value)}),i.valueExpr in e&&(t.valueExpr=c({id:e[i.valueExpr][0].ldterm},"nested"in e[i.valueExpr][0]?o(e[i.valueExpr][0].nested):{})),f(e,t),t}throw Error("unknown tripleExpr type in "+JSON.stringify(e))}function f(e,t){return i.min in e&&(t.min=parseInt(e[i.min][0].ldterm.value)),i.max in e&&(t.max=parseInt(e[i.max][0].ldterm.value),isNaN(t.max)&&(t.max=p)),i.annotation in e&&(t.annotations=e[i.annotation].map(e=>({type:"Annotation",predicate:e.nested[i.predicate][0].ldterm,object:e.nested[i.object][0].ldterm}))),i.semActs in e&&(t.semActs=e[i.semActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),t}},valToSimple:function(e){var t,n=this;function r(e){return e.reduce((e,t)=>(Object.keys(t).forEach(n=>{e[n]=n in e?Array.from(new Set(e[n].concat(t[n]))):t[n]}),e),{})}if("TripleConstraintSolutions"===e.type)return"solutions"in e?e.solutions.reduce((e,t)=>{if(!("referenced"in t))return{};var i={};return function e(t){if(!t)return!1;if(t.node===s.nil)return!0;if("solution"in t&&"solutions"in t.solution&&1===t.solution.solutions.length&&"expressions"in t.solution.solutions[0]&&2===t.solution.solutions[0].expressions.length&&"predicate"in t.solution.solutions[0].expressions[0]&&t.solution.solutions[0].expressions[0].predicate===s.first&&t.solution.solutions[0].expressions[1].predicate===s.rest){var a=t.solution.solutions[0].expressions,o=a[0],u=a[1].solutions[0],p=o.solutions[0],c={ldterm:p.object};if("referenced"in p){var l=n.valToSimple(p.referenced);l&&(c.nested=l)}return i=r(i),u.object===s.nil||e(u.referenced)}}(t.referenced)?r(e):r(e,n.valToSimple(t.referenced))},[]):[];if(-1!==["TripleConstraintSolutions"].indexOf(e.type))return{};if("NodeTest"===e.type)return(t={})[h(e.node)]=[e.shape],t;if("ShapeTest"===e.type)return(t={})[h(e.node)]=[e.shape],"solution"in e?r([t].concat(n.valToSimple(e.solution))):t;if("Recursion"===e.type)return{};if("solutions"in e)return r(e.solutions.map(e=>n.valToSimple(e)));if("expressions"in e)return r(e.expressions.map(e=>n.valToSimple(e)));throw Error("unknown shapeExpression type in "+JSON.stringify(e))},simpleToShapeMap:function(e){return Object.keys(e).reduce((t,n)=>(e[n].forEach(e=>{t.push({node:n,shape:e})}),t),[])},absolutizeShapeMap:function(e,t){return e.map(e=>Object.assign(e,{node:n.resolveRelativeIRI(t,e.node),shape:n.resolveRelativeIRI(t,e.shape)}))},errsToSimple:function(n,r,i){var s=this;if("FailureList"===n.type)return n.errors.reduce((e,t)=>e.concat(s.errsToSimple(t)),[]);if("Failure"===n.type)return["validating "+n.node+" as "+n.shape+":"].concat(function e(t){return t.reduce((function(t,n){var r=Object.keys(n);return t.concat(1===r.length&&"errors"===r[0]?e(n.errors):n)}),[])}(n.errors).reduce((e,t)=>{var n=s.errsToSimple(t).map(e=>"  "+e);return e.length>0?e.concat(["  OR"]).concat(n):n.map(e=>"  "+e)},[]));if("TypeMismatch"===n.type){var a=n.errors.constructor===Array?n.errors.reduce((e,t)=>e.concat(("string"==typeof t?[t]:s.errsToSimple(t)).map(e=>"  "+e)),[]):"  "+("string"==typeof e?[n.errors]:s.errsToSimple(n.errors));return["validating "+h(n.triple.object)+":"].concat(a)}if("ShapeAndFailure"===n.type)return n.errors.constructor===Array?n.errors.reduce((e,t)=>e.concat(("string"==typeof t?[t]:s.errsToSimple(t)).map(e=>"  "+e)),[]):"  "+("string"==typeof e?[n.errors]:s.errsToSimple(n.errors));if("ShapeOrFailure"===n.type)return n.errors.constructor===Array?n.errors.reduce((e,t)=>e.concat(" OR "+("string"==typeof t?[t]:s.errsToSimple(t))),[]):" OR "+("string"==typeof e?[n.errors]:s.errsToSimple(n.errors));if("ShapeNotFailure"===n.type)return["Node "+n.errors.node+" expected to NOT pass "+n.errors.shape];if("ExcessTripleViolation"===n.type)return["validating "+h(n.triple.object)+": exceeds cardinality"];if("ClosedShapeViolation"===n.type)return["ClosedShapeError: unexpected: {"].concat(n.unexpectedTriples.map(e=>"  "+e.subject+" "+e.predicate+" "+h(e.object)+" .")).concat(["}"]);if("NodeConstraintViolation"===n.type){var o,u=t("../lib/ShExWriter")();return u._write(u._writeNodeConstraint(n.shapeExpr).join("")),u.end((e,t)=>{o=t}),["NodeConstraintError: expected to match "+o]}if("MissingProperty"===n.type)return["Missing property: "+n.property];if("NegatedProperty"===n.type)return["Unexpected property: "+n.property];if(n.constructor===Array)return n.reduce((e,t)=>{var n=s.errsToSimple(t).map(e=>"  "+e);return e.length?e.concat(["AND"]).concat(n):n},[]);throw Error("unknown shapeExpression type in "+JSON.stringify(n))},resolveRelativeIRI:n.resolveRelativeIRI,resolvePrefixedIRI:function(e,t){var n=e.indexOf(":");if(-1===n)return null;var r=t[e.substr(0,n)];return void 0===r?null:r+e.substr(n+1)},parsePassedNode:function(e,t,r,i,s){if(void 0===e||0===e.length)return i&&i(t.base)?t.base:r?r():this.NotSupplied;if("_"===e[0]&&":"===e[1])return e;if('"'===e[0]){var a=e.match(/^"((?:[^"\\]|\\")*)"(?:@(.+)|\^\^(?:<(.*)>|([^:]*):(.*)))?$/);if(!a)throw Error("malformed literal: "+e);var o=a[1],u=a[2],p=a[3],c=a[4],l=a[5],f='"'+o+'"';if(void 0!==u)return f+"@"+u;if(void 0!==c){if(!(c in t.prefixes))throw Error("error parsing node "+e+' no prefix for "'+c+'"');return f+"^^"+t.prefixes[c]+l}return void 0!==p?f+"^^"+n.resolveRelativeIRI(t.base,p):f}if(!t)return i(e)?e:this.UnknownIRI;var d="<"===e[0]&&">"===e[e.length-1];d&&(e=e.substr(1,e.length-2));var h=n.resolveRelativeIRI(t.base||"",e);if(i(h))return h;if(!d){var v=this.resolvePrefixedIRI(e,t.prefixes);if(null!==v&&i(v))return v}return s?s(h):this.UnknownIRI},executeQueryPromise:function(e,t){var n=t+"?query="+encodeURIComponent(e);return fetch(n,{headers:{Accept:"application/sparql-results+json"}}).then(e=>e.json()).then(e=>{var t=e.head.vars;return e.results.bindings.map(e=>t.map(t=>{var n=e[t];switch(n.type){case"uri":return n.value;case"bnode":return"_:"+n.value;case"literal":var r=n.datatype,i=n["xml:lang"];return'"'+n.value+'"'+(r?"^^"+r:i?"@"+i:"");default:throw"unknown XML results type: "+n.prop("tagName")}return e[t]}))})},executeQuery:function(e,t){var n=t+"?query="+encodeURIComponent(e),r=new XMLHttpRequest;r.open("GET",n,!1),r.setRequestHeader("Accept","application/sparql-results+json"),r.send();var i,s=(i=JSON.parse(r.responseText)).head.vars;return i.results.bindings.map(e=>s.map(t=>{var n=e[t];switch(n.type){case"uri":return n.value;case"bnode":return"_:"+n.value;case"literal":var r=n.datatype,i=n["xml:lang"];return'"'+n.value+'"'+(r?"^^"+r:i?"@"+i:"");default:throw"unknown XML results type: "+n.prop("tagName")}return e[t]}))},makeN3DB:function(e,t){return{getNeighborhood:function(r,i){var s;t&&(s=new Date,t.start(!1,r,i));var a=e.getQuads(r,null,null,null).map(n.internalTriple);if(t){var o=new Date;t.end(a,o-s),s=o}t&&t.start(!0,r,i);var u=e.getQuads(null,null,r,null).map(n.internalTriple);return t&&t.end(u,new Date-s),{outgoing:a,incoming:u}},getSubjects:function(){return e.getSubjects().map(n.internalTerm)},getPredicates:function(){return e.getPredicates().map(n.internalTerm)},getObjects:function(){return e.getObjects().map(n.internalTerm)},getQuads:function(){return e.getQuads.apply(e,arguments).map(n.internalTriple)},get size(){return e.size}}},makeQueryDB:function(e,t){var n=this;function r(t,r,i){return n.executeQuery(t,e).map(e=>r?{subject:r,predicate:e[0],object:e[1]}:{subject:e[0],predicate:e[1],object:i})}return{getNeighborhood:function(e,i,s){var a,o,u,p,c=(o=s.expression,u=n.Visitor(),p={out:[],inc:[]},u.visitTripleConstraint=function(e){return p[e.inverse?"inc":"out"].push(e),e},o&&u.visitExpression(o),p),l=c.out.map(e=>e.predicate);l=l.filter((e,t)=>l.lastIndexOf(e)===t),t&&(a=new Date,t.start(!1,e,i));var f=c.out.length>0||s.closed?r(s.closed?`SELECT ?p ?o { <${e}> ?p ?o }`:"SELECT ?p ?o {\n"+l.map(t=>`  {<${e}> <${t}> ?o BIND(<${t}> AS ?p)}`).join(" UNION\n")+"\n}",e,null):[];if(t){var d=new Date;t.end(f,d-a),a=d}t&&t.start(!0,e,i);var h=c.inc.length>0?r(`SELECT ?s ?p { ?s ?p <${e}> }`,null,e):[];return t&&t.end(h,new Date-a),{outgoing:f,incoming:h}},getQuads:function(e,t,n,i){return r("SELECT "+[e?"":"?s",t?"":"?p",n?"":"?o","{",e||"?s",t||"?s",n||"?s","}"].join(" "),e,n)},getSubjects:function(){return["!Query DB can't index subjects"]},getPredicates:function(){return["!Query DB can't index predicates"]},getObjects:function(){return["!Query DB can't index objects"]},get size(){}}},NotSupplied:"-- not supplied --",UnknownIRI:"-- not found --",_expect:function(e,t,n){t in e||this._error("expected "+JSON.stringify(e)+" to have a ."+t),arguments.length>2&&e[t]!==n&&this._error("expected "+e[e]+" to equal ."+n)},_error:function(e){throw new Error(e)},unescapeText:function(e,t){try{return e=e.replace(/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\(.)/g,(function(e,n,r,i){var s;if(n){if(s=parseInt(n,16),isNaN(s))throw new Error;return String.fromCharCode(s)}if(r){if(s=parseInt(r,16),isNaN(s))throw new Error;return s<65535?String.fromCharCode(s):String.fromCharCode(55296+((s-=65536)>>10),56320+(1023&s))}var a=t[i];if(!a)throw new Error("no replacement found for '"+i+"'");return a}))}catch(e){return console.warn(e),""}}};function h(e){if("object"!=typeof e)return e;var t='"'+e.value+'"';return"language"in e?t+"@"+e.language:"type"in e?t+"^^"+e.type:t}function v(e,t){for(var n in d)t?e.prototype[n]=m(d[n]):e[n]=d[n];return e}function m(e){return function(t){return e(this,t)}}return v(v)}();void 0!==t&&void 0!==r&&(n.exports=i)},{"../lib/ShExWriter":8,"./RdfTerm":5,"hierarchy-closure":11}],7:[function(e,t,n){(function(r){var i=function(){var t=-1,n={term:"START"},i="VERBOSE"in r.env,s=e("./RdfTerm");let a=e("./ShExUtil");function o(e){return s.isIRI(e)?e:s.isLiteral(e)?s.getLiteralValue(e):e.substr(2)}var u="http://www.w3.org/2001/XMLSchema#",p=[u+"integer",u+"nonPositiveInteger",u+"negativeInteger",u+"long",u+"int",u+"short",u+"byte",u+"nonNegativeInteger",u+"unsignedLong",u+"unsignedInt",u+"unsignedShort",u+"unsignedByte",u+"positiveInteger"],c=[u+"decimal"].concat(p),l=[u+"float",u+"double"].concat(c),f={};f[u+"integer"]=function(e,t){return e.match(/^[+-]?[0-9]+$/)||t("illegal integer value '"+e+"'"),parseInt(e)},f[u+"decimal"]=function(e,t){return e.match(/^[+-]?(?:[0-9]*\.[0-9]+|[0-9]+)$/)||t("illegal decimal value '"+e+"'"),parseFloat(e)};const d=/^[+\-]?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[eE][+\-]?[0-9]+)?$/;f[u+"float"]=function(e,t){return"NaN"===e?NaN:"INF"===e?1/0:"-INF"===e?-1/0:(e.match(d)||t("illegal float value '"+e+"'"),parseFloat(e))},f[u+"double"]=function(e,t){return"NaN"===e?NaN:"INF"===e?1/0:"-INF"===e?-1/0:(e.match(d)||t("illegal double value '"+e+"'"),Number(e))},testRange=function(e,t,n){var r={integer:{min:-1/0,max:1/0},decimal:{min:-1/0,max:1/0},float:{min:-1/0,max:1/0},double:{min:-1/0,max:1/0},nonPositiveInteger:{min:-1/0,max:0},negativeInteger:{min:-1/0,max:-1},long:{min:-0x8000000000000000,max:0x8000000000000000},int:{min:-2147483648,max:2147483647},short:{min:-32768,max:32767},byte:{min:-128,max:127},nonNegativeInteger:{min:0,max:1/0},unsignedLong:{min:0,max:0x10000000000000000},unsignedInt:{min:0,max:4294967295},unsignedShort:{min:0,max:65535},unsignedByte:{min:0,max:255},positiveInteger:{min:1,max:1/0}}[t.substr(u.length)];if(!r)throw Error("unexpected datatype: "+t);e<r.min?n('"'+e+'"^^<'+t+"> is less than the min:",r.min):e>r.max&&n('"'+e+'"^^<'+t+"> is greater than the max:",r.min)};var h={length:function(e,t){return e.length===t},minlength:function(e,t){return e.length>=t},maxlength:function(e,t){return e.length<=t}},v={mininclusive:function(e,t){return e>=t},minexclusive:function(e,t){return e>t},maxinclusive:function(e,t){return e<=t},maxexclusive:function(e,t){return e<t}},m={totaldigits:function(e,t){var n=e.match(/[0-9]/g);return n&&n.length<=t},fractiondigits:function(e,t){var n=e.match(/^[+-]?[0-9]*\.?([0-9]*)$/);return n&&n[1].length<=t}};function x(e){if('"'!==e[0])return e;var t={value:s.getLiteralValue(e)},n=s.getLiteralType(e);n&&"http://www.w3.org/2001/XMLSchema#string"!==n&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==n&&(t.type=n);var r=s.getLiteralLanguage(e);return r&&(t.language=r),t}function y(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}function g(e,n,r){function i(){this.type="Epsilon"}function s(e,t,n,r,i){this.type="TripleConstraint",this.inverse=!!n,this.negated=!!r,this.predicate=t,void 0!==i&&(this.valueExpr=i)}function a(e){this.type="Choice",this.disjuncts=e}function o(e){this.type="EachOf",this.conjuncts=e}function u(e,t){this.type="SemActs",this.expression=e,this.semActs=t}function p(e){this.type="KleeneStar",this.expression=e}return e?function e(r,c){var l;function f(e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=1),1===n&&1===r)return e;var s=r===t?new p(e):w(r-n).reduce((function(t,n,r){return new a(0===r?[e,new i]:[new o([e,t]),new i])}),void 0);return 0!==n?new o(w(n).map((function(t){return e})).concat(s)):s}if("string"==typeof r)return e(c._index.tripleExprs[r].expression,c);if("TripleConstraint"===r.type){var d="valueExprRef"in r?c.valueExprDefns[r.valueExprRef]:r.valueExpr;return l=f(new s(n.push(r)-1,r.predicate,r.inverse,r.negated,d),r.min,r.max),r.semActs?new u(l,r.semActs):l}if("OneOf"===r.type)return l=f(new a(r.expressions.map((function(t){return e(t,c)}))),r.min,r.max),r.semActs?new u(l,r.semActs):l;if("EachOf"===r.type)return l=f(new o(r.expressions.map((function(t){return e(t,c)}))),r.min,r.max),r.semActs?new u(l,r.semActs):l;throw Error("unexpected expr type: "+r.type)}(e,r):new i}var E=function(){function e(e){return s.isLiteral(e)?-1!==["http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#double"].indexOf(s.getLiteralType(e))?parseInt(s.getLiteralValue(e)):e:s.isBlank(e)?e:"<"+e+">"}return e(this.subject)+" "+e(this.predicate)+" "+e(this.object)+" ."};function S(e){return{byPredicate:e.reduce((function(e,t){var n=t.predicate;return n in e||(e[n]=[]),e[n].push(t),i&&(t.toString=E),e}),{}),candidates:w(e.length).map((function(){return[]})),misses:[]}}function b(e,t){var[n,r]=[e,t].map(e=>s.isBlank(e)?1:s.isLiteral(e)?2:3);return n===r?e.localeCompare(t):n-r}function w(e){return 0===e?[]:Array(e).join(" ").split(/ /)}function O(e,t,n){t in e||j("expected "+JSON.stringify(e)+" to have a '"+t+"' attribute."),arguments.length>2&&e[t]!==n&&j("expected "+t+" attribute '"+e[t]+"' to equal '"+n+"'.")}function _(){}function j(){var e=Array.prototype.join.call(arguments,""),t=new Error(e);throw Error.captureStackTrace(t,j),t}return{construct:function t(r,c){if(!(this instanceof t))return new t(r,c);let d=r._index||a.index(r);this.type="ShExValidator",c=c||{},this.options=c,this.options.or=this.options.or||"someOf",this.options.partition=this.options.partition||"exhaustive","noCache"in c&&c.noCache||(this.known={});var E=this;this.schema=r,this._expect=this.options.lax?_:O,this._optimize={},this.reset=function(){};var T=this.options.regexModule||e("../lib/regex/threaded-val-nerr");this.getAST=function(){return{type:"AST",shapes:r.shapes.reduce((function(e,t){return e[t.id]={type:"ASTshape",expression:g(t.expression,[],E.schema)},e}),{})}},this.indexTripleConstraints=function(e){var t=[];return e&&function e(n){"string"==typeof n?e(d.tripleExprs[n]):"TripleConstraint"===n.type?t.push(n):"OneOf"===n.type||"EachOf"===n.type?n.expressions.forEach((function(t){e(t)})):j("unexpected expr type: "+n.type)}(e),t},this.emptyTracker=function(){var e=e=>e;return{recurse:e,known:e,enter:function(e,t){++this.depth},exit:function(e,t,n){--this.depth},depth:0}},this.validate=function(e,t,i,a,o){if("object"==typeof t&&"termType"in t&&(t=s.internalTerm(t)),"object"==typeof t){var u=t;if("api"===this.options.results)return u.map(t=>{var n=new Date,r=this.validate(e,t.node,t.shape,i,a);return n=new Date-n,{node:t.node,shape:t.shape,status:"errors"in r?"nonconformant":"conformant",appinfo:r,elapsed:n}});var p=u.reduce((t,n)=>{var r=this.validate(e,n.node,n.shape,a,o);return"errors"in r?{passes:t.passes,failures:t.failures.concat(r)}:{passes:t.passes.concat(r),failures:t.failures}},{passes:[],failures:[]});return p.failures.length?1!==p.failures.length?{type:"FailureList",errors:p.failures}:p.failures[0]:1!==p.passes.length?{type:"SolutionList",solutions:p.passes}:p.passes[0]}var c=void 0===a;a||(a=this.emptyTracker()),i&&i!==n||r.start||j("start production not defined");var l=null;i==n?l=r.start:"shapes"in this.schema&&0!==this.schema.shapes.length?i in d.shapeExprs?l=d.shapeExprs[i]:j("shape "+i+" not found in:\n"+Object.keys(d.shapeExprs||[]).map(e=>"  "+e).join("\n")):j("shape "+i+" not found; no shapes in schema"),void 0===o&&(o={});var f=t+"@"+(i===n?"_: -start-":i);if(f in o)return a.recurse({type:"Recursion",node:x(t),shape:i});if("known"in this&&f in this.known)return a.known(this.known[f]);o[f]={point:t,shape:i},a.enter(t,i);var h=this._validateShapeExpr(e,t,l,i,a,o);return a.exit(t,i,h),delete o[f],"known"in this&&(this.known[f]=h),"startActs"in r&&c&&(h.startActs=r.startActs),h},this._validateShapeExpr=function(e,t,n,i,s,a){if(""===t)throw Error("validation needs a valid focus node");if("string"==typeof n)return this._validateShapeExpr(e,t,d.shapeExprs[n],n,s,a);if("NodeConstraint"===n.type)return(o=this._errorsMatchingNodeConstraint(t,n,null)).length?{type:"Failure",node:x(t),shape:i,errors:o.map((function(e){return{type:"NodeConstraintViolation",shapeExpr:n,error:e}}))}:{type:"NodeTest",node:x(t),shape:i,shapeExpr:n};if("Shape"===n.type)return this._validateShape(e,t,T.compile(r,n,d),n,i,s,a);if("ShapeExternal"===n.type)return this.options.validateExtern(e,t,i,s,a);if("ShapeOr"===n.type){for(var o=[],u=0;u<n.shapeExprs.length;++u){var p=n.shapeExprs[u];if(!("errors"in(l=this._validateShapeExpr(e,t,p,i,s,a))))return{type:"ShapeOrResults",solution:l};o.push(l)}return{type:"ShapeOrFailure",errors:o}}if("ShapeNot"===n.type)return"errors"in(l=this._validateShapeExpr(e,t,n.shapeExpr,i,s,a))?{type:"ShapeNotResults",solution:l}:{type:"ShapeNotFailure",errors:l};if("ShapeAnd"===n.type){var c=[];for(u=0;u<n.shapeExprs.length;++u){var l;p=n.shapeExprs[u];if("errors"in(l=this._validateShapeExpr(e,t,p,i,s,a)))return{type:"ShapeAndFailure",errors:[l]};c.push(l)}return{type:"ShapeAndResults",solutions:c}}throw Error("expected one of Shape{Ref,And,Or} or NodeConstraint, got "+JSON.stringify(n))},this._validateShape=function(e,t,n,s,a,o,u){var p=this,c=null;if("startActs"in r&&!this.semActHandler.dispatchAll(r.startActs,null,{}))return{type:"Failure",node:x(t),shape:a,errors:["semact failure"]};for(var l,f,d,h,v=e.getNeighborhood(t,a,s),m=S(v.outgoing.sort((e,t)=>b(e.object,t.object))),y=S(v.incoming.sort((e,t)=>b(e.subject,t.subject))),g=v.outgoing.length,E=v.outgoing.concat(v.incoming),O=this.indexTripleConstraints(s.expression),_=O.reduce((function(t,n,r){n.inverse,n.inverse;var i=(n.inverse?y:m).byPredicate[n.predicate]||[];var s=p._triplesMatchingShapeExpr(i,n.valueExpr,n.inverse,(function(t,n){var r=p.validate(e,t,n,o,u);return"errors"in r?r.errors:[]}),(function(t,n){var r=p._validateShapeExpr(e,t,n,a,o,u);return"errors"in r?r.errors:[]}));return s.hits.forEach((function(e){t.constraintList[E.indexOf(e)].push(r)})),s.misses.forEach((function(e){t.misses[E.indexOf(e.triple)]={constraintNo:r,errors:e.errors}})),t}),{misses:{},constraintList:w(E.length).map((function(){return[]}))}),j=[],T=_.constraintList.reduce((function(e,t,n){return 0===t.length&&n<g&&n in _.misses&&(void 0!==s.extra&&-1!==s.extra.indexOf(E[n].predicate)?j.push(n):e.push({tripleNo:n,constraintNo:_.misses[n].constraintNo,errors:_.misses[n].errors})),e}),[]),A=(l=_.constraintList,f=l.length,d=[],h=null,{next:function(){if(null!==h&&0===h.length)return!1;if(null===h)return function(){h=[];for(var e=0;e<f;e++)d[e]=0,h[e]=l[e][0]}(),!0;var e=f-1;if(d[e]++,d[e]<l[e].length)return h[e]=l[e][d[e]],!0;for(;d[e]>=l[e].length;){if(0==e)return!1;d[e]=0,h[e]=l[e][0],d[--e]++}return h[e]=l[e][d[e]],!0},do:function(e,t){return e.apply(t,h)},get:function(){return h}}),N=[];0===T.length&&A.next()&&null===c;){var k=[],L=w(E.length).map((function(){return 0})),I=A.get();if(s.closed){var R=E.slice(0,g).filter((e,t)=>void 0===I[t]&&-1===j.indexOf(t));if(R.length>0){N.push({errors:[{type:"ClosedShapeViolation",unexpectedTriples:R}]});continue}}function C(){var e=O.length;return I.slice().reduce((function(e,t,n){return void 0!==t&&e[t].push(n),e}),w(e).map((function(){return[]})))}function V(t,n){return p.validate(e,t,n,o,u)}function B(t,n){return p._validateShapeExpr(e,t,n,a,o,u)}function M(e,t,n,r){return p._errorsMatchingShapeExpr(e,t,n,r)}I.forEach((function(e,t){void 0!==e&&(k.push(E[t]),++L[e])})),I.slice().sort((function(e,t){return e-t})).filter((function(e){return void 0!==e})).map((function(e){return e+" "})).join("");var D=n.match(e,t,O,C(),I,E,V,B,this.semActHandler,M,null);if("errors"in D){if(N.push({errors:D.errors}),"exhaustive"!==p.options.partition)break}else{var J={type:"ShapeTest",node:x(t),shape:a};if(Object.keys(D).length>0&&(J.solution=D),"semActs"in s&&!this.semActHandler.dispatchAll(s.semActs,D,J)){if(N.push({errors:[{type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}]}),"exhaustive"!==p.options.partition)break}else c=J}}if(null===c){var F=T.map((function(e){var t=E[e.tripleNo];return{type:"TypeMismatch",triple:{type:"TestedTriple",subject:t.subject,predicate:t.predicate,object:x(t.object)},constraint:O[e.constraintNo],errors:e.errors}}));c={type:"Failure",node:x(t),shape:a,errors:F.concat(1===N.length?N[0].errors:N)}}return i&&E.forEach((function(e){delete e.toString})),function(e){"annotations"in s&&(e.annotations=s.annotations);return e}(c)},this._triplesMatchingShapeExpr=function(e,t,n,r,i){var s=this,a=[],o=[];return e.forEach((function(e){var u=n?e.subject:e.object,p=void 0===t?[]:s._errorsMatchingShapeExpr(u,t,r,i);0===p.length?o.push(e):-1===o.indexOf(e)&&a.push({triple:e,errors:p})})),{hits:o,misses:a}},this._errorsMatchingShapeExpr=function(e,t,n,r){var i=this;if("string"==typeof t)return n?n(e,t):[];if("NodeConstraint"===t.type)return this._errorsMatchingNodeConstraint(e,t,null);if("Shape"===t.type)return void 0===r?[]:r(e,t);if("ShapeOr"===t.type){for(var s=[],a=0;a<t.shapeExprs.length;++a){var o=i._errorsMatchingShapeExpr(e,t.shapeExprs[a],n,r);if(0===o.length)return o;s=s.concat(o)}return s}if("ShapeAnd"===t.type)return t.shapeExprs.reduce((function(t,s,a){return t.concat(i._errorsMatchingShapeExpr(e,s,n,r,!0))}),[]);if("ShapeNot"===t.type)return(s=i._errorsMatchingShapeExpr(e,t.shapeExpr,n,r,!0)).length?[]:["Error validating "+e+" as "+JSON.stringify(t)+": expected NOT to pass"];throw Error("unknown value expression type '"+t.type+"'")},this._errorsMatchingNodeConstraint=function(e,t,n){var r=[],i=s.isLiteral(e)?s.getLiteralValue(e):s.isBlank(e)?e.substring(2):e,a=s.isLiteral(e)?s.getLiteralType(e):null,c=-1!==p.indexOf(a)?u+"integer":-1!==l.indexOf(a)?a:void 0;function d(){var n=Array.prototype.join.call(arguments,"");return r.push("Error validating "+e+" as "+JSON.stringify(t)+": "+n),!1}if("nodeKind"in t&&(-1===["iri","bnode","literal","nonliteral"].indexOf(t.nodeKind)&&d("unknown node kind '"+t.nodeKind+"'"),s.isBlank(e)?"iri"!==t.nodeKind&&"literal"!==t.nodeKind||d("blank node found when "+t.nodeKind+" expected"):s.isLiteral(e)?"literal"!==t.nodeKind&&d("literal found when "+t.nodeKind+" expected"):"bnode"!==t.nodeKind&&"literal"!==t.nodeKind||d("iri found when "+t.nodeKind+" expected")),t.datatype&&t.values&&d("found both datatype and values in "+tripleConstraint),t.datatype&&(s.isLiteral(e)?s.getLiteralType(e)!==t.datatype?d("mismatched datatype: "+s.getLiteralType(e)+" !== "+t.datatype):c?testRange(f[c](i,d),t.datatype,d):t.datatype===u+"boolean"?"true"!==i&&"false"!==i&&"1"!==i&&"0"!==i&&d("illegal boolean value: "+i):t.datatype===u+"dateTime"&&(i.match(/^[+-]?\d{4}-[01]\d-[0-3]\dT[0-5]\d:[0-5]\d:[0-5]\d(\.\d+)?([+-][0-2]\d:[0-5]\d|Z)?$/)||d("illegal dateTime value: "+i)):d("mismatched datatype: "+e+" is not a literal with datatype "+t.datatype)),t.values&&(s.isLiteral(e)&&t.values.reduce((t,n)=>{if(t)return!0;var r=x(e);return"Language"===n.type?n.languageTag===r.language:"object"==typeof n&&"value"in n&&(n.value===r.value&&n.type===r.type&&n.language===r.language)},!1)||-1!==t.values.indexOf(e)||t.values.some((function(t){if("object"==typeof t&&!("value"in t)){"type"in t||j("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var n=["Language","IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];function r(e,n,r){return s.isLiteral(e)?-1!==["LiteralStem","LiteralStemRange"].indexOf(t.type)?r(s.getLiteralValue(e),n):-1!==["LanguageStem","LanguageStemRange"].indexOf(t.type)?r(s.getLiteralLanguage(e)||null,n):d("literal "+e+" not comparable with non-literal "+n):-1===["IriStem","IriStemRange"].indexOf(t.type)?d("nonliteral "+e+" not comparable with literal "+JSON.stringify(n)):r(e,n)}function i(e,n){return r(e,n,(e,n)=>"LanguageStem"===t.type||"LanguageStemRange"===t.type?null!==e&&(e===n||""===n||"-"===e[n.length]):e.startsWith(n))}if(-1===n.indexOf(t.type)&&j("expected type attribute '"+t.type+"' to be in '"+n+"'."),y(t.stem)){if(!i(e,t.stem))return!1}else O(t.stem,"type","Wildcard");return!t.exclusions||!t.exclusions.some((function(t){if(y(t))return r(e,t,(e,t)=>e===t);"type"in t||j("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var n=["IriStem","LiteralStem","LanguageStem"];return-1===n.indexOf(t.type)&&j("expected type attribute '"+t.type+"' to be in '"+n+"'."),i(e,t.stem)}))}}))||d("value "+e+" not found in set "+JSON.stringify(t.values))),"pattern"in t){var g="flags"in t?new RegExp(t.pattern,t.flags):new RegExp(t.pattern);o(e).match(g)||d("value "+o(e)+" did not match pattern "+t.pattern)}return Object.keys(h).forEach((function(n){n in t&&!h[n](i,t[n])&&d("facet violation: expected "+n+" of "+t[n]+" but got "+e)})),Object.keys(v).forEach((function(n){n in t&&(c?v[n](f[c](i,d),t[n])||d("facet violation: expected "+n+" of "+t[n]+" but got "+e):d("facet violation: numeric facet "+n+" can't apply to "+e))})),Object.keys(m).forEach((function(n){n in t&&(c===u+"integer"||c===u+"decimal"?m[n](""+f[c](i,d),t[n])||d("facet violation: expected "+n+" of "+t[n]+" but got "+e):d("facet violation: numeric facet "+n+" can't apply to "+e))})),r},this.semActHandler={handlers:{},results:{},register:function(e,t){this.handlers[e]=t},dispatchAll:function(e,t,n){var r=this;return e.reduce((function(e,i){if(e&&i.name in r.handlers){var s="code"in i?i.code:E.options.semActs[i.name],a="extensions"in n&&i.name in n.extensions,o=a?n.extensions[i.name]:{};return e=e&&r.handlers[i.name].dispatch(s,t,o),!a&&Object.keys(o).length>0&&("extensions"in n||(n.extensions={}),n.extensions[i.name]=o),e}return e}),!0)}}},start:n,options:{or:{oneOf:"exactly one disjunct must pass",someOf:"one or more disjuncts must pass",firstOf:"disjunct evaluation stops after one passes"},partition:{greedy:"each triple constraint consumes all triples matching predicate and object",exhaustive:"search all mappings of triples to triple constriant"}}}}();void 0!==e&&void 0!==n&&(t.exports=i)}).call(this,e("_process"))},{"../lib/regex/nfax-val-1err":9,"../lib/regex/threaded-val-nerr":10,"./RdfTerm":5,"./ShExUtil":6,_process:1}],8:[function(e,t,n){var r=function(){var t=e("util"),n=-1,r=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,i=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,s={"\\":"\\\\",'"':'\\"',"/":"\\/","\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"},a={iri:"IRI",bnode:"BNODE",literal:"LITERAL",nonliteral:"NONLITERAL"};function o(e,t){if(!(this instanceof o))return new o(e,t);if(e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},e)this._outputStream=e,this._endStream=void 0===t.end||!!t.end;else{var n="";this._outputStream={write:function(e,t,r){n+=e,r&&r()},end:function(e){e&&e(null,n)}},this._endStream=!0}this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes),this._error=t.error||c,this.forceParens=!t.simplifyParentheses,this._expect=t.lax?f:l}function u(e){var t=s[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}function p(e){return e.replace(/\\/g,"\\\\").replace(/%/g,"\\%")}function c(e,t){"function"!=typeof e&&(t=e,e=c);var n=new Error(t);throw Error.captureStackTrace(n,e),n}function l(e,t,n){t in e||this._error(l,"expected "+e+" to have a ."+t),arguments.length>2&&e[t]!==n&&this._error(l,"expected "+e[e]+" to equal ."+n)}function f(){}return o.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeSchema:function(e,t){var n=this;this._expect(e,"type","Schema"),n.addPrefixes(e.prefixes),e.base&&n._write("BASE "+this._encodeIriOrBlankNode(e.base)+"\n"),e.imports&&e.imports.forEach((function(e){n._write("IMPORT "+n._encodeIriOrBlankNode(e)+"\n")})),e.startActs&&e.startActs.forEach((function(e){n._expect(e,"type","SemAct"),n._write(" %"+n._encodePredicate(e.name)+("code"in e?"{"+p(e.code)+"%}":"%"))})),e.start&&n._write("start = "+n._writeShapeExpr(e.start,t,!0,0).join("")+"\n"),"shapes"in e&&e.shapes.forEach((function(e){n._write(n._encodeShapeName(e.id,!1)+" "+n._writeShapeExpr(e,t,!0,0).join("")+"\n",t)}))},_writeShapeExpr:function(e,n,r,i){var s=this,a=[];if("string"==typeof e)a.push("@",s._encodeShapeName(e));else if("ShapeExternal"===e.type)a.push("EXTERNAL");else if("ShapeAnd"===e.type){i>=3&&a.push("(");var o=!1;e.shapeExprs.forEach((function(t,r){if(r>0){function i(t){let n=e.shapeExprs[t];return!("NodeConstraint"!==n.type||"nodeKind"in n&&"literal"===n.nodeKind||"datatype"in n||"values"in n)}let t=!o&&(i(r-1)&&function(t){let n=e.shapeExprs[t];return"Shape"===n.type||"ShapeRef"===n.type}(r)||(u=r-1,"Shape"===e.shapeExprs[u].type&&i(r)));t||a.push(" AND "),o=t}var u;a=a.concat(s._writeShapeExpr(t,n,!1,3))})),i>=3&&a.push(")")}else if("ShapeOr"===e.type)i>=2&&a.push("("),e.shapeExprs.forEach((function(e,t){t>0&&a.push(" OR "),a=a.concat(s._writeShapeExpr(e,n,r,2))})),i>=2&&a.push(")");else if("ShapeNot"===e.type)i>=4&&a.push("("),a.push("NOT "),a=a.concat(s._writeShapeExpr(e.shapeExpr,n,r,4)),i>=4&&a.push(")");else if("Shape"===e.type)a=a.concat(s._writeShape(e,n,r));else{if("NodeConstraint"!==e.type)throw Error("expected Shape{,And,Or,Ref} or NodeConstraint in "+t.inspect(e));a=a.concat(s._writeNodeConstraint(e,n,r))}return a},_writeShape:function(e,t,r){var i,s=this;try{var a=[];this._expect(e,"type","Shape"),e.closed&&a.push("CLOSED "),e.extra&&e.extra.length>0&&(a.push("EXTRA "),e.extra.forEach((function(e,t){a.push(s._encodeShapeName(e,!1)+" ")})),a.push(" "));function o(e,t){0===e&&1===t?a.push("?"):0===e&&t===n?a.push("*"):void 0===e&&void 0===t||(1===e&&t===n?a.push("+"):a.push("{",e,",",t===n?"*":t,"}"))}return a.push("{\n"),e.expression&&function e(n,r,i){function u(e){e&&e.forEach((function(e){s._expect(e,"type","SemAct"),a.push("\n"+r+"   %"),a.push(s._encodeValue(e.name)),"code"in e?a.push("{"+p(e.code)+"%}"):a.push("%")}))}function c(t,n,s,o){var u=s<i||o;u&&a.push("("),t.forEach((function(i,o){e(i,r+"  ",s),o<t.length-1&&a.push(n)})),u&&a.push(")")}if("string"==typeof n)a.push("&"),a.push(s._encodeShapeName(n,!1));else if("id"in n&&(a.push("$"),a.push(s._encodeIriOrBlankNode(n.id,!0))),"TripleConstraint"===n.type)n.inverse&&a.push("^"),n.negated&&a.push("!"),a.push(r,s._encodePredicate(n.predicate)," "),"valueExpr"in n?a=a.concat(s._writeShapeExpr(n.valueExpr,t,!0,0)):a.push(". "),o(n.min,n.max),s._annotations(a,n.annotations,r),u(n.semActs);else if("OneOf"===n.type){var l="id"in n||"min"in n||"max"in n||"annotations"in n||"semActs"in n;c(n.expressions,"\n"+r+"| ",1,l||s.forceParens),o(n.min,n.max),s._annotations(a,n.annotations,r),u(n.semActs)}else{if("EachOf"!==n.type)throw Error("unexpected expr type: "+n.type);l="id"in n||"min"in n||"max"in n||"annotations"in n||"semActs"in n;c(n.expressions,";\n"+r,2,l||s.forceParens),o(n.min,n.max),s._annotations(a,n.annotations,r),u(n.semActs)}}(e.expression,"  ",0),a.push("\n}"),(i=e.semActs)&&i.forEach((function(e){s._expect(e,"type","SemAct"),a.push(" %",s._encodePredicate(e.name),"code"in e?"{"+p(e.code)+"%}":"%")})),s._annotations(a,e.annotations,"  "),a}catch(e){t&&t(e)}},_writeNodeConstraint:function(e,t){try{this._expect(e,"type","NodeConstraint");var n=[];return e.nodeKind in a?n.push(a[e.nodeKind]," "):void 0!==e.nodeKind&&this._error("unexpected nodeKind: "+e.nodeKind),this._fillNodeConstraint(n,e,t),this._annotations(n,e.annotations,"  "),n}catch(e){t&&t(e)}},_annotations:function(e,t,n){var r=this;t&&t.forEach((function(t){r._expect(t,"type","Annotation"),e.push("//\n"+n+"   "),e.push(r._encodeValue(t.predicate)),e.push(" "),e.push(r._encodeValue(t.object))}))},_fillNodeConstraint:function(e,t,n){var r=this;if(t.datatype&&t.values&&r._error("found both datatype and values in "+expr),t.datatype&&e.push(r._encodeShapeName(t.datatype)),t.values&&(e.push("["),t.values.forEach((function(t,n){if(n>0&&e.push(" "),o(t))e.push(r._encodeValue(t));else{"type"in t||runtimeError("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var s=["Language","IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];function a(e,t){return-1!==["LanguageStem","LanguageStemRange"].indexOf(e.type)?"@"+t:-1!==["LiteralStem","LiteralStemRange"].indexOf(e.type)?'"'+t.replace(i,t)+'"':r._encodeValue(t)}-1===s.indexOf(t.type)&&runtimeError("expected type attribute '"+t.type+"' to be in '"+s+"'."),"Language"===t.type?e.push("@"+t.languageTag):o(t.stem)?e.push(a(t,t.stem)+"~"):(l(t.stem,"type","Wildcard"),e.push(".")),t.exclusions&&t.exclusions.forEach((function(n){if(e.push(" - "),o(n))e.push(a(t,n));else{"type"in n||runtimeError("expected "+JSON.stringify(n)+" to have a 'type' attribute.");var r=["IriStem","LiteralStem","LanguageStem"];-1===r.indexOf(n.type)&&runtimeError("expected type attribute '"+n.type+"' to be in '"+r+"'."),e.push(a(t,n.stem)+"~")}}))}})),e.push("]")),"pattern"in t){var s=t.pattern.replace(/\//g,"\\/"),a="flags"in t?t.flags:"";e.push("/"+s+"/"+a+" ")}return["length","minlength","maxlength","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits"].forEach((function(n){t[n]&&e.push(" ",n," ",t[n])})),e;function o(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}},_encodeIriOrBlankNode:function(e,t){if(t=t?" ":"","_"===e[0]&&":"===e[1])return e;r.test(e)&&(e=e.replace(i,u));var n=this._prefixRegex.exec(e);return n?(n[1]?this._prefixIRIs[n[1]]+n[2]:e)+t:"<"+e+">"},_encodeLiteral:function(e,t,n){return r.test(e)&&(e=e.replace(i,u)),n?'"'+e+'"@'+n:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeShapeName:function(e,t){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return this._encodeIriOrBlankNode(e,t)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e?"a":this._encodeIriOrBlankNode(e)},_encodeValue:function(e){return"object"!=typeof e?this._encodeIriOrBlankNode(e):this._encodeLiteral(e.value,e.type,e.language)},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},writeSchema:function(e,t){this._writeSchema(e,t),this.end(t)},addShape:function(e,t,n){this._write(_ShExWriter._encodeShapeName(t,!1)+" "+_ShExWriter._writeShapeExpr(e,n,!0,0).join(""),n)},addShapes:function(e){for(var t=0;t<e.length;t++)this.addShape(e[t])},addPrefix:function(e,t,n){var r={};r[e]=t,this.addPrefixes(r,n)},addPrefixes:function(e,t){var n=this._prefixIRIs,r=!1;for(var i in e){var s=e[i];n[s]!==(i+=":")&&(r=!0,n[s]=i,this._write("PREFIX "+i+" <"+s+">\n"))}if(r){var a="",o="";for(var u in n)a+=a?"|"+u:u,o+=(o?"|":"")+n[u];a=a.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+o+")[^/]*$|^("+a+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(r?"\n":"",t)},_prefixRegex:/$0^/,end:function(e){this._write=this._blockedWrite;var t=e&&function(n,r){t=null,e(n,r)};if(this._endStream)try{return this._outputStream.end(t)}catch(e){}t&&t()}},o}();void 0!==e&&void 0!==n&&(t.exports=r)},{util:4}],9:[function(e,t,n){var r=function(){var t=e("../RdfTerm"),r="<span class='keyword' title='Split'>|</span>",i="<span class='keyword' title='Repeat'>×</span>",s="<span class='keyword' title='Match'>␃</span>",a=-1;function o(e){e||(e={});for(var t,n=1,r=arguments.length;n<r&&(t=arguments[n]||{});n++)for(var i in t)e[i]=t[i];return e}return n={name:"nfax-val-1err",description:"simple regular expression engine with n out states",compile:function(e,n,u){var p=n.expression;return function(){var e=[],t=f(s,[]),n=t;if(p){var o=function t(n,s){var p,c;var l;function h(t,r){return null!=n.min&&1!==n.min||null!=n.max&&1!==n.max?(p=f(i,[t]),e[p].expr=n,e[p].min="min"in n?n.min:1,e[p].max="max"in n?n.max===a?1/0:n.max:1,d(r,p),{start:p,tail:[p]}):{start:t,tail:r}}if("string"==typeof n){var v=u.tripleExprs[n];return t(v,s)}if("TripleConstraint"===n.type)return p=f(n,[]),e[p].stack=s,{start:p,tail:[p]};if("OneOf"===n.type)return l=[],c=[],n.expressions.forEach((function(e,r){o=t(e,s.concat({c:n,e:r})),c.push(o.start),l=l.concat(o.tail)})),p=f(r,c),e[p].expr=n,h(p,l);if("EachOf"===n.type)return n.expressions.forEach((function(e,r){o=t(e,s.concat({c:n,e:r})),0===r?p=o.start:d(l,o.start),l=o.tail})),h(p,l);throw Error("unexpected expr type: "+n.type)}(p,[]);d(o.tail,t),n=o.start}var l={algorithm:"rbenx",end:t,states:e,start:n,match:c};return t=e=n=null,l;function f(t,n,r){var i=e.length;return e.push({c:t,outs:n}),r&&(e[i].negated=!0),i}function d(t,n){t.forEach(t=>{e[t].outs.push(n)})}}();function c(n,r,i,s,u,p,c,v,m,x,y){var g=this,E=[],S=[];function b(e){return e.map(e=>{var t=g.states[e.state];return renderAtom(t.c,t.negated)})}if(1===g.states.length)return h([],i,p,c,v,m,x);var w=null;for(f(g,E,this.start,{repeats:{},avail:[],matched:[],stack:[],errors:[]});E.length;){S=[],y&&y.push({threads:[]});for(var O=0;O<E.length;++O){var _=E[O];if(_.state!==g.end){var j=g.states[_.state],T=S.length,A=i.indexOf(j.c),N="min"in j.c?j.c.min:1,k="max"in j.c?j.c.max===a?1/0:j.c.max:1;"negated"in j.c&&j.c.negated&&(N=k=0),void 0===_.avail[A]&&(_.avail[A]=s[A].slice());var L=_.avail[A].splice(0,k);if(L.length>=N)do{l(g,S,_,L)}while(_.avail[A].length>0&&L.length<k&&(L.push(_.avail[A].shift()),1));y&&y[y.length-1].threads.push({state:E[O].state,to:S.slice(T).map(e=>d(e.state,e.repeats))})}}if(0===S.length&&null===w)return C(b(g.states));var I=E;E=S,S=I;var R=E.reduce((e,t)=>{var n=t.matched.reduce((e,t)=>e+t.triples.length,0)===u.reduce((e,t)=>void 0===t?e:e+1,0);return null!==e?e:t.state===g.end&&n?t:null},null);R&&(w=R)}if(null===w)return C();function C(){return{type:"Failure",node:r,errors:b(g.states)}}function b(){return E.map(n=>{var r=g.states[n.state].c,i=null;return"string"==typeof r.valueExpr?(i=r.valueExpr,t.isBlank(i)&&(i=e.shapes[i])):r.valueExpr&&(i=o({},r.valueExpr)),o({type:j.c.negated?"NegatedProperty":n.state===g.end?"ExcessTripleViolation":"MissingProperty",property:j.c.predicate},i?{valueExpr:i}:{})})}return"errors"in w.matched?w.matched:h(w.matched,i,p,c,v,m,x)}function l(e,t,n,r){var s=e.states[n.state],a=e.states.map(e=>e.c===i?e.expr:null),o=s.stack.map(e=>{var t=n.repeats[a.indexOf(e.c)];return void 0===t?t=0:t-=1,{c:e.c,e:e.e,i:t}}),u={c:s.c,triples:r,stack:o};n.matched=n.matched.concat(u),s.outs.forEach(r=>{f(e,t,r,n)})}function f(e,t,n,s,a){a=a||[];var o=d(n,s.repeats);if(-1===a.indexOf(o)){a.push(o);var u=e.states[n];if(u.c===r)return u.outs.reduce((n,r,i)=>n.concat(f(e,t,r,s,a)),[]);if(u.c===i){var p=[];n in s.repeats||(s.repeats[n]=0);var c=s.repeats[n];return c<u.max&&(p=p.concat(f(e,t,u.outs[0],function(e,t){var n=Object.keys(e.repeats).reduce((n,r)=>(n[r]=parseInt(r)==t?e.repeats[r]+1:e.repeats[r],n),{});return{state:e.state,repeats:n,matched:e.matched,avail:e.avail.slice(),stack:e.stack}}(s,n),a))),c>=u.min&&c<=u.max&&(p=p.concat(f(e,t,u.outs[1],function(e,t){var n=Object.keys(e.repeats).reduce((n,r)=>(parseInt(r)!==t&&(n[r]=e.repeats[r]),n),{});return{state:e.state,repeats:n,matched:e.matched,avail:e.avail.slice(),stack:e.stack}}(s,n),a))),p}return[t.push({state:n,repeats:s.repeats,avail:s.avail.map(e=>e.slice()),stack:s.stack,matched:s.matched,errors:s.errors})-1]}}function d(e,t){var n=Object.keys(t).map(e=>e+":"+t[e]).join(",");return n.length?e+"-"+n:""+e}function h(e,r,i,s,a,o,u){var p=[],c=[],l=[],f=e.reduce((e,n)=>{for(var r,d=0,h=e;d<p.length&&n.stack[d].c===p[d].c&&n.stack[d].i===p[d].i&&n.stack[d].e===p[d].e;)h=h.solutions[p[d].i].expressions[p[d].e],++d;for(;d<n.stack.length;){if(d>=p.length&&p.push({}),n.stack[d].c!==p[d].c){if(r=[],h.type="EachOf"===n.stack[d].c.type?"EachOfSolutions":"OneOfSolutions",h.solutions=r,"min"in n.stack[d].c&&(h.min=n.stack[d].c.min),"max"in n.stack[d].c&&(h.max=n.stack[d].c.max),"annotations"in n.stack[d].c&&(h.annotations=n.stack[d].c.annotations),"semActs"in n.stack[d].c&&(h.semActs=n.stack[d].c.semActs),h=r,p[d].i=null,"semActs"in n.stack[d].c&&!o.dispatchAll(n.stack[d].c.semActs,"???",h))throw{type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]};f&&"semActs"in expr&&(f.semActs=expr.semActs)}else h=h.solutions;if(n.stack[d].i!==p[d].i?(r=[],h[n.stack[d].i]={type:"EachOf"===n.stack[d].c.type?"EachOfSolution":"OneOfSolution",expressions:r},h=r,p[d].e=null):h=h[p[d].i].expressions,n.stack[d].e===p[d].e)throw"how'd we get here?";r={},h[n.stack[d].e]=r,n.stack[d].e>0&&void 0===h[n.stack[d].e-1]&&-1===l.indexOf(h)&&l.push(h),h=r,p.length=d+1,++d}return h.type="TripleConstraintSolutions","min"in n.c&&(h.min=n.c.min),"max"in n.c&&(h.max=n.c.max),h.predicate=n.c.predicate,"valueExpr"in n.c&&(h.valueExpr=n.c.valueExpr),"productionLabel"in n.c&&(h.productionLabel=n.c.productionLabel),h.solutions=n.triples.map(e=>{var r=i[e],p={type:"TestedTriple",subject:r.subject,predicate:r.predicate,object:function(e){if('"'!==e[0])return e;var n={value:t.getLiteralValue(e)},r=t.getLiteralType(e);r&&"http://www.w3.org/2001/XMLSchema#string"!==r&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==r&&(n.type=r);var i=t.getLiteralLanguage(e);i&&(n.language=i);return n}(r.object)};function l(e,n,r){var i=r(e,n);if("errors"in i){var s={type:"ReferenceError",focus:e,shape:n,errors:i};return"string"==typeof shapeLabel&&t.isBlank(shapeLabel)&&(s.referencedShape=n),[s]}return("solution"in i&&0!==Object.keys(i.solution).length||"Recursion"===i.type)&&(p.referenced=i),[]}return"valueExpr"in h&&(c=c.concat(u(h.inverse?r.subject:r.object,h.valueExpr,(function(e,t){return l(e,t,s)}),(function(e,t){return l(e,t,a)})))),0===c.length&&"semActs"in n.c&&!o.dispatchAll(n.c.semActs,r,p)&&c.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),p}),"annotations"in n.c&&(h.annotations=n.c.annotations),"semActs"in n.c&&(h.semActs=n.c.semActs),p=n.stack.slice(),e},{});return c.length?{type:"SemActFailure",errors:c}:(l.forEach(e=>{for(var t=0;t<e.length;++t)null!==e[t]&&void 0!==e[t]||e.splice(t--,1)}),"semActs"in n&&(f.semActs=n.semActs),f)}}}}();void 0!==e&&void 0!==n&&(t.exports=r)},{"../RdfTerm":5}],10:[function(e,t,n){var r=function(){var t=e("../RdfTerm"),n=-1;function r(e){e||(e={});for(var t,n=1,r=arguments.length;n<r&&(t=arguments[n]||{});n++)for(var i in t)e[i]=t[i];return e}return{name:"threaded-val-nerr",description:"emulation of regular expression engine with error permutations",compile:function(e,i,s){var a=i.expression;return{match:function(e,o,u,p,c,l,f,d,h,v,m){if(!a)return{};var x=function e(i,a){if("string"==typeof i)return e(s.tripleExprs[i],a);var o=u.indexOf(i),c="min"in i?i.min:1,l="max"in i?i.max===n?1/0:i.max:1;function f(e,t){var n=0,s=[a],o={};("min"in i&&1!==i.min||"max"in i&&1!==i.max)&&(o.min=i.min,o.max=i.max),"semActs"in i&&(o.semActs=i.semActs),"annotations"in i&&(o.annotations=i.annotations);for(;n<l;++n){for(var u=[],p=0;p<s.length;++p){var f=s[p],d=t(f);if(d.length>0&&0===d[0].errors.length&&d.forEach(t=>{var n="expression"in f?f.expression.solutions:[];"solution"in t&&(n=n.concat(t.solution)),delete t.solution,t.expression=r({type:e,solutions:n},o)}),0===d.length||d[0].errors.length>0)return n<c?d:s;u=u.concat(d)}s=u}if(s.length>0&&0===s[0].errors.length&&"semActs"in i){var v=[],m=[];s.forEach(e=>{h.dispatchAll(i.semActs,"???",e)?v.push(e):(e.errors.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),m.push(e))}),s=v.length>0?v:m}return s}if("TripleConstraint"===i.type){var d="negated"in i&&i.negated||0===l;d&&(c=l=1/0),void 0===a.avail[o]&&(a.avail[o]=p[o].slice());var v={};("min"in i&&1!==i.min||"max"in i&&1!==i.max)&&(v.min=i.min,v.max=i.max),"semActs"in i&&(v.semActs=i.semActs),"annotations"in i&&(v.annotations=i.annotations);var m=a.avail[o].splice(0,c),x=d?0===m.length:m.length>=c,y=[],g=a.matched;if(x)do{y.push({avail:a.avail.map(e=>e.slice()),errors:a.errors.slice(),matched:g.concat({tNos:m.slice()}),expression:r({type:"TripleConstraintSolutions",predicate:i.predicate,solutions:m.map(e=>({type:"halfTestedTriple",tripleNo:e,constraintNo:o}))},"valueExpr"in i?{valueExpr:i.valueExpr}:{},"productionLabel"in i?{productionLabel:i.productionLabel}:{},v)})}while(a.avail[o].length>0&&m.length<l&&(m.push(a.avail[o].shift()),1));else{var E=null;"string"==typeof i.valueExpr?(E=i.valueExpr,t.isBlank(E)&&(E=s.shapeExprs[E])):i.valueExpr&&(E=r({},i.valueExpr)),y.push({avail:a.avail,errors:a.errors.concat([r({type:d?"NegatedProperty":"MissingProperty",property:i.predicate},E?{valueExpr:E}:{})]),matched:g})}return y}return"OneOf"===i.type?f("OneOfSolutions",t=>{var n=[],r=[];return i.expressions.forEach(i=>{var s={avail:t.avail.map(e=>e.slice()),errors:t.errors,matched:t.matched},a=e(i,s);0===a[0].errors.length?(n=n.concat(a),a.forEach(e=>{var t="solution"in s?s.solution.expressions:[];"expression"in e&&(t=t.concat([e.expression])),delete e.expression,e.solution={type:"OneOfSolution",expressions:t}})):r=r.concat(a)}),n.length>0?n:r}):"EachOf"===i.type?f("EachOfSolutions",t=>i.expressions.reduce((t,n)=>t.reduce((t,r)=>{var i=e(n,r);return i.forEach(e=>{if(0===e.errors.length){var t="solution"in r?r.solution.expressions:[];"expression"in e&&(t=t.concat([e.expression])),delete e.expression,e.solution={type:"EachOfSolution",expressions:t}}}),t.concat(i)},[]),[t])):void runtimeError("unexpected expr type: "+i.type)}(a,{avail:[],matched:[],errors:[]}),y=x.reduce((e,t)=>{if(t.errors.length>0)return e;var n={};return Object.keys(c).forEach(e=>{void 0!==c[e]&&(n[e]=c[e])}),t.matched.forEach(e=>{e.tNos.forEach(e=>{delete n[e]})}),Object.keys(n).forEach(e=>{t.errors.push({type:"ExcessTripleViolation",triple:l[e],constraint:u[n[e]]})}),null!==e?e:Object.keys(n).length>0?null:t},null);return null!==y?function(e,n,r,s,a,o,u){Object.keys(e).length>0&&function p(c){function l(e){if('"'!==e[0])return e;var n={value:t.getLiteralValue(e)},r=t.getLiteralType(e);r&&"http://www.w3.org/2001/XMLSchema#string"!==r&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==r&&(n.type=r);var i=t.getLiteralLanguage(e);return i&&(n.language=i),n}if("OneOfSolutions"===c.type||"EachOfSolutions"===c.type)c.solutions.forEach(e=>{e.expressions.forEach(e=>{p(e)})});else{if("TripleConstraintSolutions"!==c.type)throw Error("unexpected expr type in "+JSON.stringify(c));c.solutions=c.solutions.map(p=>{if("TestedTriple"===p.type)return p;var c=r[p.tripleNo],f=n[p.constraintNo],d={type:"TestedTriple",subject:c.subject,predicate:c.predicate,object:l(c.object)};function h(e,n,r){var s=r(e,n);if("errors"in s){var a={type:"ReferenceError",focus:e,shape:n};return"string"==typeof n&&t.isBlank(n)&&(a.referencedShape=i),a.errors=s,[a]}return("solution"in s&&0!==Object.keys(s.solution).length||"Recursion"===s.type)&&(d.referenced=s),[]}var v="valueExpr"in f?u(f.inverse?c.subject:c.object,f.valueExpr,(function(e,t){return h(e,t,s)}),(function(e,t){return h(e,t,a)})):[];return 0===v.length&&"semActs"in f&&!o.dispatchAll(f.semActs,c,d)&&v.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),v.length>0&&(e.errors=e.errors||[],e.errors=e.errors.concat(v)),d})}}(e);"semActs"in i&&(e.semActs=i.semActs);return e}(y.expression,u,l,f,d,h,v):x.length>1?{type:"PossibleErrors",errors:x.reduce((e,t)=>e.concat([t.errors]),[])}:x[0]}}}}}();void 0!==e&&void 0!==n&&(t.exports=r)},{"../RdfTerm":5}],11:[function(e,t,n){var r={create:function(){let e={},t={},n={},r={};return{add:function(i,s){if(i in n&&-1!==n[i].indexOf(s))return;let a=i in r?p(i):e[i]=p(i),o=p(s);function u(e,t,n,r){e[r]=e[r].filter(t=>-1===e[n].indexOf(t)).concat(-1===e[n].indexOf(n)?[n]:[],e[n]),e[n].forEach(e=>t[e]=t[e].filter(e=>e!==r&&-1===t[r].indexOf(e)).concat(-1===t[r].indexOf(r)?[r]:[],t[r]))}function p(e){return e in r||(t[e]=[],n[e]=[],r[e]={}),r[e]}a[s]=o,delete e[s],u(n,t,s,i),u(t,n,i,s)},roots:e,parents:t,children:n}},depthFirst:function e(t,n,r){return Object.keys(t).reduce((i,s)=>i.concat(e(t[s],n,s),r?n(s,r):[]),[])}};void 0!==e&&void 0!==n&&(t.exports=r)},{}],12:[function(e,t,n){var r={RdfTerm:e("./lib/RdfTerm"),Util:e("./lib/ShExUtil"),Validator:e("./lib/ShExValidator"),Writer:e("./lib/ShExWriter"),"nfax-val-1err":e("./lib/regex/nfax-val-1err"),"threaded-val-nerr":e("./lib/regex/threaded-val-nerr")};void 0!==e&&void 0!==n&&(t.exports=r)},{"./lib/RdfTerm":5,"./lib/ShExUtil":6,"./lib/ShExValidator":7,"./lib/ShExWriter":8,"./lib/regex/nfax-val-1err":9,"./lib/regex/threaded-val-nerr":10}]},{},[12])(12)}));